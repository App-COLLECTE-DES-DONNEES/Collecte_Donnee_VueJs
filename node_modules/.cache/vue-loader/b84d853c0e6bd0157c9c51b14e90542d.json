{"remainingRequest":"C:\\wamp64\\www\\toolsmctc\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\wamp64\\www\\toolsmctc\\src\\views\\app\\caisses\\box.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\wamp64\\www\\toolsmctc\\src\\views\\app\\caisses\\box.vue","mtime":1638183563915},{"path":"C:\\wamp64\\www\\toolsmctc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\wamp64\\www\\toolsmctc\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\wamp64\\www\\toolsmctc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\wamp64\\www\\toolsmctc\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgogICAgaW1wb3J0IEF1dG9Db21wbGV0ZSBmcm9tICIuL0F1dG9jb21wbGV0ZSIKICAgIGltcG9ydCB1c2VBdXRvY29tcGxldGUgZnJvbSAnLi4vLi4vLi4vc3RvcmUvbW9kdWxlcy91c2VBdXRvY29tcGxldGUnCiAgICBpbXBvcnQgQ2F0cHJvZHVjdGVzIGZyb20gIi4vY2F0cHJvZHVjdGVzIgogICAgaW1wb3J0IHNhbGVzcmVjZWlwdCBmcm9tICIuL3NhbGVzcmVjZWlwdCIKICAgIGltcG9ydCBiaWxhbiBmcm9tICIuLi9jb21wb25lbnRzL2JpbGFuIgogICAgLy9pbXBvcnQgcmVnaXN0ZXJQYXJ0bmVycyBmcm9tICIuLi9jb21wb25lbnRzL3JlZ2lzdGVycGFydG5lcnMiCiAgICBpbXBvcnQgcmVmZXJlbmNlIGZyb20gIi4uL2NvbXBvbmVudHMvcmVmZXJlbmNlIgogICAgaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnCiAgICBpbXBvcnQgY29uc3RhbnRzIGZyb20gJy4uLy4uLy4uL3BsdWdpbnMvY29uc3RhbnRzJwogICAgaW1wb3J0IHsgbWFwR2V0dGVycyxtYXBBY3Rpb25zIH0gZnJvbSAidnVleCI7CgoKICAgIC8vaW1wb3J0IFZ1ZSBmcm9tICd2dWUnCiAgICBpbXBvcnQgeyBtYWtlVG9hc3QgfSBmcm9tICcuLi8uLi8uLi9wbHVnaW5zL2Z1bmN0aW9ucycKCgogICAgZXhwb3J0IGRlZmF1bHQgewoKICAgICAgICBtZXRhSW5mbzogewogICAgICAgICAgICB0aXRsZTogIkNhaXNzZSIKICAgICAgICB9LAoKICAgICAgICBkYXRhKCkgewogICAgICAgICAgICByZXR1cm4gewoKICAgICAgICAgICAgICAgIG51bWVyb2NvbnRhY3RzOiIiLAogICAgICAgICAgICAgICAgZm9yY2FyZDpmYWxzZSwKICAgICAgICAgICAgICAgIG9wZW5iOnRydWUsCiAgICAgICAgICAgICAgICBjbG9zZWI6dHJ1ZSwKICAgICAgICAgICAgICAgIGNoYXNzaToiY2hhc3NpcyIsCiAgICAgICAgICAgICAgICBzZWxlY3Rob2xkdmFyOmZhbHNlLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzX3VybHM6Y29uc3RhbnRzLnJlc291cmNlX3VybHMsCiAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCksCiAgICAgICAgICAgICAgICBjYXQ6W10sCiAgICAgICAgICAgICAgICB1c2VyaW5wdXQ6IiIsCiAgICAgICAgICAgICAgICBib3hvcGVuOmZhbHNlLAogICAgICAgICAgICAgICAgY29udGFjdHNJZDo1LAogICAgICAgICAgICAgICAgYm94OmZhbHNlLAogICAgICAgICAgICAgICAgbW9kYWx0YXg6ZmFsc2UsCiAgICAgICAgICAgICAgICBlbmNhaXNzZW1lbnRzOnt9LAogICAgICAgICAgICAgICAgYmlsYW46e30sCgogICAgICAgICAgICAgICAgZm9ybTogewogICAgICAgICAgICAgICAgICAgIG51bV90aWNrZXQ6JzEyMycsCiAgICAgICAgICAgICAgICAgICAgbW9udGFudF9lbmNhaXNzZTowLAogICAgICAgICAgICAgICAgICAgIFJlZmVyZW5jZToiaGVsbG8iLAogICAgICAgICAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiAiIiwKICAgICAgICAgICAgICAgICAgICBlbWFpbHM6ICIiLAogICAgICAgICAgICAgICAgICAgIGZOYW1lOiAiIiwKICAgICAgICAgICAgICAgICAgICBsTmFtZTogIiIsCiAgICAgICAgICAgICAgICAgICAgcGhvbmU6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb3V2ZXJ0dXJlQW1vdW50OjAsCiAgICAgICAgICAgICAgICByZXN1bHRzZWFyY2g6W10sCiAgICAgICAgICAgICAgICBzZWxlY3Rpb246W10sCiAgICAgICAgICAgICAgICBNb250YW50X3RvdGFsOjAsCiAgICAgICAgICAgICAgICBpbnZvaWNlX3RheDogMCwKICAgICAgICAgICAgICAgIGludm9pY2VfdGF4czogMCwKICAgICAgICAgICAgICAgIGludm9pY2VfdG90YWw6IDAsCiAgICAgICAgICAgICAgICBzaG93TW9kYWw6dHJ1ZSwKICAgICAgICAgICAgICAgIGNsaWVudHM6W10sCiAgICAgICAgICAgICAgICBwcm9kdWN0czpbXSwKICAgICAgICAgICAgICAgIHNob3c6ZmFsc2UsCiAgICAgICAgICAgICAgICBjdXN0b21lckZvcm06CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjbmk6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBub206ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBwcmVub206ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBwaG9uZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGJpcnRoZGF5OiIiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXNzcG9ydDoiIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGVybWlfZGVfY29uZHVpcmU6IiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICBzZWFyY2g6ZmFsc2UsCiAgICAgICAgICAgICAgICBjb250YWN0OnsKICAgICAgICAgICAgICAgICAgICBOYW1lOiIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmVuZGV1cjp7CiAgICAgICAgICAgICAgICAgICAgTmFtZToiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRvY3VtZW50OiJjZyIsCiAgICAgICAgICAgICAgICB2YXJpYW50OiIiLAogICAgICAgICAgICAgICAgY291bnRyeTp0aGlzLiRzdG9yZS5zdGF0ZS5hdXRoRGF0YS5jb3VudHJ5LAogICAgICAgICAgICAgICAgbGlzdHByb2R1Y3RzOlsKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBsaXN0dGF4OlsKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICB0YXg6W10sCiAgICAgICAgICAgICAgICBzdGF0dXRlOmZhbHNlLAogICAgICAgICAgICAgICAgc2hvd19yZWZlcjpmYWxzZSwKICAgICAgICAgICAgICAgIHNlbGVjdGhvbGQ6e30sCiAgICAgICAgICAgICAgICB0YXhlczpbXSwKICAgICAgICAgICAgICAgIHNlbGVjdGVkOltdLAogICAgICAgICAgICAgICAgb3B0aW9uc0tleToibm9tIiwKICAgICAgICAgICAgICAgIG9wdGlvbnNLZXkxOiJwcmVub20iLAogICAgICAgICAgICAgICAgZmllbGRzOiBbIkTDqXNpZ25hdGlvbiIsICJSZWZlcmVuY2UiLCAiRG9jdW1lbnQiLCJQcml4IiwiVGF4ZXMiLCJBY3Rpb25zIl0sCiAgICAgICAgICAgICAgICAvL2ZpZWxkOiBbIkTDqXNpZ25hdGlvbiIsICJQcml4IiwiUHJpeCJdLAogICAgICAgICAgICAgICAgZmllbGQ6IiIsCiAgICAgICAgICAgICAgICBob2xkbGlzdDpbXSwKICAgICAgICAgICAgICAgIGVuY29tcHRlOmZhbHNlLAogICAgICAgICAgICAgICAgY29kZXBheXM6JycsCiAgICAgICAgICAgICAgICBkZXZpc2U6JycsCiAgICAgICAgICAgICAgICBudW1lcm9jbGllbnQ6IiIKCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBiZWZvcmVNb3VudCgpewoKICAgICAgICAgIHRoaXMuY29kZXBheXMgPSB0aGlzLiRpMThuLmxvY2FsZQogICAgICAgICAgICB0aGlzLmRldmlzZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkZXZpc2UnKQoKICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvZGVwYXllcycsdGhpcy4kc3RvcmUuc3RhdGUuYXV0aERhdGEucm9sZSkKCiAgICAgICAgICAgIGlmKHRoaXMuJHN0b3JlLnN0YXRlLmF1dGhEYXRhLnJvbGUuaW5kZXhPZignY2cnKSAhPT0gLTEpewogICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAnYWxsdmlzaXRfbGlzdCcsIHBhcmFtczogeyBpZDogJzAnIH19KQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHRoaXMuJHN0b3JlLnN0YXRlLmF1dGhEYXRhLnJvbGUuaW5kZXhPZignY29udHJvbGV1cicpICE9PSAtMSl7CiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7bmFtZTogJ3Zpc2l0X3N0YXJ0J30pCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBmaWx0ZXJzOnsKICAgICAgICAgICAgbW9tZW50ZXM6IGZ1bmN0aW9uIChkYXRlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50KGRhdGUpLmZvcm1hdCgneXl5eS1NTS1kZCBISDptbScpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3VycmVuY3lzOmZ1bmN0aW9uICh2YWx1ZSxjb2RlcGF5cyxkZXZpc2UpIHsKCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludGwuTnVtYmVyRm9ybWF0KGNvZGVwYXlzLCB7IHN0eWxlOiAnY3VycmVuY3knLCBjdXJyZW5jeTogZGV2aXNlIH0pLmZvcm1hdCh2YWx1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGN1cnJlbmN5c291dDpmdW5jdGlvbiAodmFsdWUsY29kZXBheXMsZGV2aXNlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaW50bCcsdmFsdWUpCiAgICAgICAgICAgICAgICB2YXIgaW50bCA9ICBuZXcgSW50bC5OdW1iZXJGb3JtYXQoY29kZXBheXMsIHsgc3R5bGU6ICdjdXJyZW5jeScsIGN1cnJlbmN5OiBkZXZpc2UgfSkuZm9ybWF0KHZhbHVlKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpbnRsJyxpbnRsKQogICAgICAgICAgICAgICAgcmV0dXJuIGludGwucmVwbGFjZShkZXZpc2UsJycpCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBjb21wb25lbnRzOntzYWxlc3JlY2VpcHQsIEF1dG9Db21wbGV0ZSxDYXRwcm9kdWN0ZXMsYmlsYW4scmVmZXJlbmNlfSwKICAgICAgICBjb21wdXRlZDogewoKICAgICAgICAgICAgLi4ubWFwR2V0dGVycyhbImdldFN0YXR1c0hvbGQiLCJnZXRQcm9kdWN0cyIsImdldEN1c3RvbWVycyIsImdldEN1c3RvbWVyIiwiZ2V0U3RhdHVzIiwiZ2V0Q2F0UHJvZHVjdHMiLCJHZXRCb3giLCJHRVRCSUxBTiIsIkdldEVuY2Fpc3NlbWVudHMiLCJnZXRPYmpldEhvbGQiLAogICAgICAgICAgICAgICAgImdldEhvbGRMaXN0IiwiZ2V0U2VsZWN0SG9sZCIsIkdldFByb2R1Y3RzSG9sZCIsIk1vdmVQcm9kdWN0c0hvbGQiLCJHZXRCb3hPcGVuIiwiR2V0Q2Fpc3NlT3BlbiIsIkdldENIRUNLU0VTU0lPTiIsIkdldFJlbW92ZUFsbFByb2R1Y3RzIl0pLAoKICAgICAgICB9LAoKICAgICAgICBtZXRob2RzOiB7CiAgICAgICAgICAgIC4uLm1hcEFjdGlvbnMoWyJGZXRjaENhdFByb2R1Y3RzIiwiRmV0Y2hTYWxlc1Byb2R1Y3RzIiwicmVnaXN0ZXJDdXN0b20iLCJGZXRjaFByb2R1Y3RzIiwKICAgICAgICAgICAgICAgICJGZXRjaFNlbGxlcnMiLCJGZXRjaENvbnRhY3RzIiwiRmV0Y2hDdXN0b21lcnMiLCJpbkFjY291bnRzIgogICAgICAgICAgICAgICAgLCJpbkJveHMiLCJhZGRob2xkIiwiY2xvc2Vib3giLCJvcGVuYm94cyIsInJlbW92ZWhvbGQiLCJjaGVja3Nlc3Npb25lIiwiaG9sZGxpc3RlIiwiU2VsZWN0SG9sZHMiLCJnZXRQcm9kdWN0c0hvbGQiLCJhZGRQcm9kdWN0c0hvbGQiLCJyZW1vdmVQcm9kdWN0c0hvbGQiLCJyZW1vdmVBbGxQcm9kdWN0c0hvbGQiXSksCgogICAgICAgICAgICBjb250YWN0c3VwZGF0ZSgpewogICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY29udGFjdHNJZCA9IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xpZW50c3VwZGF0ZSgpewogICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY2xpZW50c0lkID0gMAogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzZXRXaW5kb3dzOiBmdW5jdGlvbiAoKXsKICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMuY2hpbGRBdXRvLnJlc2V0V2luZG93KCk7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmNoaWxkQXV0b3MucmVzZXRXaW5kb3coKTsKICAgICAgICAgICAgICAgIHRoaXMuZm9ybS5SZWZlcmVuY2UgPSAiICIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNhdmVjaGFuZ2UoZGF0YSl7CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NhdmVjaGFuZ2UnLGRhdGEpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzd2l0Y2goZGF0YS5tc2cpewoKICAgICAgICAgICAgICAgICAgICBjYXNlICdjbGllbnRzJzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1lcm9jbGllbnQgPSBkYXRhLml0ZW0udGVsZXBob25lCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLm5vbWNsaWVudCA9IGRhdGEuaXRlbS5ub20gKyAiICIgK2RhdGEuaXRlbS5wcmVub20KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY2xpZW50c0lkID0gZGF0YS5pdGVtLmNsaWVudElkCgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY29udGFjdHMnOgoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5udW1lcm9jb250YWN0cyA9IGRhdGEuaXRlbS50ZWxlcGhvbmUKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMubm9tY29udGFjdHMgPSBkYXRhLml0ZW0ubm9tICsgIiAiICtkYXRhLml0ZW0ucHJlbm9tCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLmNvbnRhY3RzSWQgPSBkYXRhLml0ZW0uY29udGFjdElkCgkJCQkJCQoJCQkJCQljb25zb2xlLmxvZygnc3RhdGUnLHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLmNvbnRhY3RzSWQpCgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdyZWZlcmVuY2UnOgoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldHJlZmVyZW5jZSh2YWx1ZSl7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZm9ybScsJ2Zvcm0nKQogICAgICAgICAgICAgICAgdGhpcy5mb3JtLlJlZmVyZW5jZT12YWx1ZQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3Blbm1vZGFsYm94KCl7CiAgICAgICAgICAgICAgICB0aGlzLiRidk1vZGFsLnNob3coJ2NvbmZpcm1vcGVuQWNjb3VudCcpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlbW9kYWxib3goKXsKICAgICAgICAgICAgICAgIHRoaXMuJGJ2TW9kYWwuc2hvdygnY29uZmlybWNsb3NlQWNjb3VudCcpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldG92ZXJsYXkodmFsdWUpewogICAgICAgICAgICAgICAgaWYoIXRoaXMuZm9yY2FyZCl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JjYXJkID0gdmFsdWUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldGxpc3Rwcih2YWx1ZSl7CgogICAgICAgICAgICAgICAgdGhpcy5mb3JjYXJkID0gZmFsc2UKICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VhcmNoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93X3JlZmVyID0gIXRoaXMuc2hvd19yZWZlcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYodmFsdWVbMF0ucHJvZHVpdCE9bnVsbCl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0cz12YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZXRsaXN0cHInLHZhbHVlWzBdLnByb2R1aXQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN0cmluZ1RvQm9vbGVhbjogZnVuY3Rpb24oc3RyaW5nKXsKCiAgICAgICAgICAgICAgICBpZihzdHJpbmchPW51bGwpewogICAgICAgICAgICAgICAgICAgIHN3aXRjaChzdHJpbmcudHJpbSgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAidHJ1ZSI6IGNhc2UgInllcyI6IGNhc2UgIjEiOiByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZmFsc2UiOiBjYXNlICJubyI6IGNhc2UgIjAiOiBjYXNlIG51bGw6IHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIEJvb2xlYW4oc3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJpbnQgKCl7CiAgICAgICAgICAgICAgICAvLyBQYXNzIHRoZSBlbGVtZW50IGlkIGhlcmUKICAgICAgICAgICAgICAgIHRoaXMuJGh0bWxUb1BhcGVyKCdwcmludE1lJyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbmNlbHMgKCl7CiAgICAgICAgICAgICAgICAvLyBQYXNzIHRoZSBlbGVtZW50IGlkIGhlcmUKICAgICAgICAgICAgICAgIHRoaXMuYm94PWZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy4kYnZNb2RhbC5oaWRlKCd0ZXN0cycpCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2FuY2VscycsdGhpcy5ib3gpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlY2Fpc3NlKCl7CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Nsb3NlJykKICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlaG9sZCh7bnVtYmVyOnRoaXMuc2VsZWN0aG9sZC5udW1iZXIsY2xvc2U6dHJ1ZX0pCiAgICAgICAgICAgICAgICAvL3RoaXMucmVtb3ZlQWxsUHJvZHVjdHNIb2xkKHtudW1iZXI6dGhpcy5zZWxlY3Rob2xkLm51bWJlcixzZXNzaW9uQ2Fpc3NlSWQ6bG9jYWxTdG9yYWdlLmdldEl0ZW0oInNlc3Npb25jYWlzc2UiKX0pCgogICAgICAgICAgICB9LAogICAgICAgICAgICByZWdpc3RlckN1c3RvbWVyKHZhcmlhbnQgPSBudWxsKSB7CgogICAgICAgICAgICAgICAgLyogc2V0VGltZW91dCgoKSA9PiB7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMucmVnaXN0ZXJQYXJ0bmVycy5yZWdpc3RlcnAodHJ1ZSkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaGVsbG8nLHRoaXMuZm9ybWF0dGVkcmVmZXJlbmNlVmFsdWUpCgogICAgICAgICAgICAgICAgfSw0MDAwKTsqLwoKICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJDdXN0b20odmFyaWFudCkKICAgICAgICAgICAgICAgIHRoaXMudmFyaWFudCAgPSB2YXJpYW50CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbGFuZGVzJyx2YXJpYW50KQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vQXVjdW4gUHJvZHVpdCBTZWxlY3Rpb25uZQogICAgICAgICAgICBpbkFjY291bnQoKSB7CgogICAgICAgICAgICAgICAgdGhpcy5zaG93PSF0aGlzLnNob3cKICAgICAgICAgICAgICAgIHRoaXMuJGJ2TW9kYWwuaGlkZSgnY29uZmlybWluQWNjb3VudCcpCgogICAgICAgICAgICAgICAgdGhpcy5pbkFjY291bnRzKAoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1aXRWdWU6dGhpcy5saXN0cHJvZHVjdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRhbnRUb3RhbDp0aGlzLmludm9pY2VfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRhbnRIVDp0aGlzLk1vbnRhbnRfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRhbnRFbmNhaXNzZTp0aGlzLmZvcm0ubW9udGFudF9lbmNhaXNzZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkNhaXNzZUlkOmxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzZXNzaW9uY2Fpc3NlIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudElkOnRoaXMuJHN0b3JlLnN0YXRlLmNsaWVudHNJZCwKICAgICAgICAgICAgICAgICAgICAgICAgdmVuZGV1cklkOnRoaXMuJHN0b3JlLnN0YXRlLnZlbmRldXJzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhY3RJZDp0aGlzLiRzdG9yZS5zdGF0ZS5jb250YWN0c0lkLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOjAsCiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmc6IHRoaXMuJGkxOG4ubG9jYWxlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIC8vdGhpcy5pbkFjY291bnRzKCkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGxhdW5jaEJveCgpewoKICAgICAgICAgIAoJCQkJY29uc29sZS5sb2coJ3N0YXRlJyx0aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy5ub21jb250YWN0cy5sZW5ndGgpCgkJCQljb25zb2xlLmxvZygnc3RhdGUnLHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLm5vbWNvbnRhY3RzKQoJCQkJY29uc29sZS5sb2coJ3N0YXRlJyx0aGlzLm51bWVyb2NvbnRhY3RzLmxlbmd0aCkKCQkJCWNvbnNvbGUubG9nKCdzdGF0ZScsdGhpcy5udW1lcm9jb250YWN0cykKCgkJCQkKICAgICAgICAgICAgICAgIC8vaWYodGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMubm9tY29udGFjdHMubGVuZ3RoPT09MCB8fCB0aGlzLm51bWVyb2NvbnRhY3RzLmxlbmd0aD09PTApewogICAgICAgICAgICAgICAgaWYodGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMubm9tY29udGFjdHMubGVuZ3RoPT09MCB8fCB0aGlzLm51bWVyb2NvbnRhY3RzLmxlbmd0aD09PTApewogICAgICAgICAgICAgICAgICAgIHRoaXMubWFrZVRvYXN0KHRoaXMuJHQoJ3NlbGVjdF9jb250YWN0JyksJ2Vycm9yJykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKHRoaXMubGlzdHByb2R1Y3RzLmxlbmd0aD09PTApewogICAgICAgICAgICAgICAgICAgIHRoaXMubWFrZVRvYXN0KHRoaXMuJHQoJ25vX3Byb2R1Y3QnKSwnZXJyb3InKQogICAgICAgICAgICAgICAgICAgIHJldHVybiA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYodGhpcy5mb3JtLm1vbnRhbnRfZW5jYWlzc2U9PT0wKXsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1ha2VUb2FzdCh0aGlzLiR0KCd3aGljaF9hbW91bnQnKSwnZXJyb3InKQogICAgICAgICAgICAgICAgICAgIHJldHVybiA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmVuY29tcHRlID0gZmFsc2UKCiAgICAgICAgICAgICAgICB0aGlzLiRidk1vZGFsLnNob3coJ2NvbmZpcm1pbkJveCcpCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBsYXVuY2hBY2NvdW50KCl7CgkJCQogICAgICAgICAgICAgICAgaWYodGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY29udGFjdHNJZD09PTApewogICAgICAgICAgICAgICAgICAgIHRoaXMubWFrZVRvYXN0KHRoaXMuJHQoJ3NlbGVjdF9jb250YWN0JyksJ2Vycm9yJykKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidk1vZGFsLmhpZGUoJ2NvbmZpcm1pbkFjY291bnQnKQogICAgICAgICAgICAgICAgICAgIHJldHVybiA7CiAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgIGlmKHRoaXMubGlzdHByb2R1Y3RzLmxlbmd0aCA9PT0gMCl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QodGhpcy4kdCgnbm9fcHJvZHVjdCcpLCdlcnJvcicpCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnZNb2RhbC5oaWRlKCdjb25maXJtaW5BY2NvdW50JykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICAgICBpZih0aGlzLmZvcm0ubW9udGFudF9lbmNhaXNzZSA+IDApewogICAgICAgICAgICAgICAgICAgIHRoaXMubWFrZVRvYXN0KHRoaXMuJHQoJ21vbnRhbnRfZW5jYWlzc2VfbnVsbCcpLCdlcnJvcicpCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnZNb2RhbC5oaWRlKCdjb25maXJtaW5BY2NvdW50JykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICAgICB0aGlzLmVuY29tcHRlID0gdHJ1ZQogICAgICAgICAgICAgICAgdGhpcy4kYnZNb2RhbC5zaG93KCdjb25maXJtaW5BY2NvdW50JykKCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbkJveCgpIHsKCiAgICAgICAgICAgICAgICB0aGlzLiRidk1vZGFsLmhpZGUoJ2NvbmZpcm1pbkJveCcpCiAgICAgICAgICAgICAgICB0aGlzLnNob3c9dHJ1ZQoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb250YWN0SUQnLHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLmNvbnRhY3RzSWQpCgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NsaWVudElkJyx0aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy5jbGllbnRzSWQpCgoKICAgICAgICAgICAgICAgIHRoaXMuaW5Cb3hzKAoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1aXRWdWU6dGhpcy5saXN0cHJvZHVjdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRhbnRUb3RhbDp0aGlzLmludm9pY2VfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRhbnRIVDp0aGlzLk1vbnRhbnRfdG90YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRhbnRFbmNhaXNzZTp0aGlzLmZvcm0ubW9udGFudF9lbmNhaXNzZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkNhaXNzZUlkOmxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzZXNzaW9uY2Fpc3NlIiksCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6KHRoaXMubGlzdHByb2R1Y3RzWzBdLmxpYmVsbGU9PT0nZGVjJyk/MjoxLAogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRJZDp0aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy5jbGllbnRzSWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHZlbmRldXJJZDp0aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy52ZW5kZXVyc0lkLAogICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0SWQ6dGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY29udGFjdHNJZCwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjY2x0OnRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLmNvbnRhY2NsdCwKICAgICAgICAgICAgICAgICAgICAgICAgbGFuZzogdGhpcy4kaTE4bi5sb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG5vbWNsaWVudDp0aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy5ub21jbGllbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIG51bWVyb2NsaWVudDp0aGlzLm51bWVyb2NsaWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgbm9tY29udGFjdHM6dGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMubm9tY29udGFjdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIG51bWVyb2NvbnRhY3RzOnRoaXMubnVtZXJvY29udGFjdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50OnRoaXMuZG9jdW1lbnQKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2VCb3goKXsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2xvc2Vib3gnKQogICAgICAgICAgICAgICAgLy90aGlzLiRidk1vZGFsLnNob3coJ2JpbGFuJylcCiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlYj1mYWxzZQogICAgICAgICAgICAgICAgdGhpcy5jbG9zZWJveCh7Im91dmVydHVyZUFtb3VudCI6dGhpcy5vdXZlcnR1cmVBbW91bnR9KQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9wZW5Cb3goKXsKCiAgICAgICAgICAgICAgICAvL3RoaXMuJGJ2TW9kYWwuaGlkZSgnY29uZmlybW9wZW5BY2NvdW50JykKICAgICAgICAgICAgICAgIC8vIGlmKHRoaXMuYm94b3Blbj09PSJmYWxzZSIpewogICAgICAgICAgICAgICAgLy8gICAgIHRoaXMubWFrZVRvYXN0KCJDYWlzc2UgT3V2ZXJ0ZSB2ZXVpbGxleiBsYSBmZXJtZXIiLCJlcnJvciIpCiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgdGhpcy5vcGVuYj1mYWxzZQogICAgICAgICAgICAgICAgdGhpcy5vcGVuYm94cyh7Im91dmVydHVyZUFtb3VudCI6dGhpcy5vdXZlcnR1cmVBbW91bnR9KQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEFkZGNhdChwcm9kdWN0KSB7CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2R1Y3QnLHByb2R1Y3QpCgogICAgICAgICAgICAgICAgaWYoKHRoaXMuZm9ybS5SZWZlcmVuY2UpPT0nJyl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QodGhpcy4kdCgncmVmX2VudGVyJyksJ2Vycm9yJykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKHByb2R1Y3QucHJvZHVpdC5saWJlbGxlPT0nZGVjJyAmJiB0aGlzLmxpc3Rwcm9kdWN0cy5sZW5ndGghPTApewoKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QodGhpcy4kdCgncHJvZHVjdF93YWl0aW5nJyksJ2Vycm9yJykKCgogICAgICAgICAgICAgICAgICAgIC8qaWYodGhpcy5saXN0cHJvZHVjdHMubGVuZ3RoIT0wKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0cHJvZHVjdHMgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUFsbFByb2R1Y3RzSG9sZChwcm9kdWN0KQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndmFsY2F0cHJvZHVjdCcscHJvZHVjdC5zZWxlY3Rob2xkKQoKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3ZhbGNhdHByb2R1Y3QnLCd2aWRlJykKICAgICAgICAgICAgICAgICAgICB9Ki8KCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJvZHVjdC5zZWxlY3Rob2xkPXRoaXMuc2VsZWN0aG9sZAogICAgICAgICAgICAgICAgcHJvZHVjdC5yZWZlcmVuY2UgPSB0aGlzLmZvcm0uUmVmZXJlbmNlCiAgICAgICAgICAgICAgICB0aGlzLmZvcmNhcmQgPSB0cnVlCiAgICAgICAgICAgICAgICB0aGlzLmFkZFByb2R1Y3RzSG9sZChwcm9kdWN0KQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLypzZWFyY2hyZWZlcmVuY2UoKXsKCiAgICAgICAgICAgICAgICB0aGlzLnNob3dfcmVmZXI9IXRoaXMuc2hvd19yZWZlcgogICAgICAgICAgICAgICAgdGhpcy5zZWFyY2ggPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hSZWZlcmVuY2UodGhpcy5mb3JtLlJlZmVyZW5jZSkKICAgICAgICAgICAgfSwqLwogICAgICAgICAgICBhcHBseVRheChwcml4LHRheGVzKXsKCiAgICAgICAgICAgICAgICB0YXhlcy5mb3JFYWNoKCh2YWx1ZSkgPT4gewoKICAgICAgICAgICAgICAgICAgICBpZighdmFsdWUuaW5jbHVzZSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHByaXggPSBwcml4ICsgKHByaXgqdmFsdWUudmFsZXVyKS8xMDAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBwcml4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNlbGVjdEhvbGQoaXRlbSl7CgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2hvbGQnLGl0ZW0ubnVtYmVyKQoKICAgICAgICAgICAgICAgIHRoaXMuU2VsZWN0SG9sZHMoaXRlbSkKICAgICAgICAgICAgICAgIC8vcmVxdWV0ZSBwb3VyIHJlY3VwZXJlciBsYSBsaXN0ZSBkZXMgcHJvZHVpdHMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2hlY2tJZEhvbGQob2JqLCBpZCkgewoKICAgICAgICAgICAgICAgIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKGl0ZW0pIHsgcmV0dXJuIGl0ZW0uaG9sZElkOyB9KS5pbmRleE9mKGlkKTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGludm9pY2VUb3RhbCgpIHsKCiAgICAgICAgICAgICAgICB2YXIgc3VidG90YWwsdG90YWw7CiAgICAgICAgICAgICAgICBzdWJ0b3RhbCA9IHRoaXMubGlzdHByb2R1Y3RzLnJlZHVjZShmdW5jdGlvbihzdW0sIGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29zdCA9IHBhcnNlRmxvYXQoaXRlbS5wcml4KTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGNvc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdW0gKyBjb3N0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDApOwoKICAgICAgICAgICAgICAgIHRoaXMuTW9udGFudF90b3RhbCA9IHN1YnRvdGFsLnRvRml4ZWQoMik7CiAgICAgICAgICAgICAgICAvLyB0YXgKICAgICAgICAgICAgICAgIC8vdG90YWwgPSBzdWJ0b3RhbCAqICh0aGlzLmludm9pY2VfdGF4IC8gMTAwKSArIHN1YnRvdGFsOwogICAgICAgICAgICAgICAgdG90YWwgPSB0aGlzLmludm9pY2VfdGF4ICsgc3VidG90YWw7CgogICAgICAgICAgICAgICAgLypzd2l0Y2ggKG9wZXJhbmRlKSB7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgIisiOgogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IHRoaXMuaW52b2ljZV90YXggKyBzdWJ0b3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgIi0iOgogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IE1hdGguYWJzKHN1YnRvdGFsIC0gdGhpcy5pbnZvaWNlX3RheCkgOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0qLwoKICAgICAgICAgICAgICAgIHRvdGFsID0gcGFyc2VGbG9hdCh0b3RhbCk7CiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKHRvdGFsKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW52b2ljZV90b3RhbCA9IHRvdGFsLnRvRml4ZWQoMik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtLm1vbnRhbnRfZW5jYWlzc2UgPSB0aGlzLmludm9pY2VfdG90YWwKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlX3RvdGFsID0gIjAuMDAiOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGF4VG90YWwocHJpeCxvcGVyYW5kZSl7CgogICAgICAgICAgICAgICAgdmFyIHN1YnRvdGFsdGF4ICxhZ2VUb3RhbDsKCiAgICAgICAgICAgICAgICAvL2xpc3Qgb2YgdGF4ZXMgb2YgdGhpc3Byb2R1Y3QKICAgICAgICAgICAgICAgIHN1YnRvdGFsdGF4ID0gIHRoaXMubGlzdHRheC5yZWR1Y2UoKGRhdGEsIHVzZXIpID0+IHsKICAgICAgICAgICAgICAgICAgICBhZ2VUb3RhbCA9IChhZ2VUb3RhbCB8fCAwKSArIHVzZXIudmFsZXVyCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFnZVRvdGFsOwogICAgICAgICAgICAgICAgfSwge30pOwoKCiAgICAgICAgICAgICAgICAvL2NhbGN1bGF0ZSBhbW91bnQgYW5kIGFkZCBpdCBpbiB0b3RhbCBhbW91dCB0YXgKICAgICAgICAgICAgICAgIGlmICghaXNOYU4oc3VidG90YWx0YXgpKSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChvcGVyYW5kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICIrIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdWJ0b3RhbCcsc3VidG90YWx0YXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludm9pY2VfdGF4ID0gdGhpcy5pbnZvaWNlX3RheCArICgoc3VidG90YWx0YXggKiBwcml4KS8xMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiLSI6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlX3RheCA9IE1hdGguYWJzKHRoaXMuaW52b2ljZV90YXggLSAoKHN1YnRvdGFsdGF4ICogcHJpeCkvMTAwKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLmludm9pY2VfdGF4cyA9IHRoaXMuaW52b2ljZV90YXg7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8qICBzdWJ0b3RhbCA9IHRoaXMubGlzdHRheC5yZWR1Y2UoZnVuY3Rpb24oc3VtLCBpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgY29zdCA9IHBhcnNlRmxvYXQoaXRlbS52YWxldXIpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihjb3N0KSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3VidG90YWwnLGNvc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN1bSArIGNvc3Q7CgogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCAwKTsqLwoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNoZWNrSWQob2JqLCBpZCkgewoKICAgICAgICAgICAgICAgIHJldHVybiBvYmoubWFwKGZ1bmN0aW9uKGl0ZW0pIHsgcmV0dXJuIGl0ZW0ucmVmZXJlbmNlOyB9KS5pbmRleE9mKGlkKTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbW92ZUNhdFByb2R1Y3RzKHByb2R1Y3QpIHsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaW5kZXgnLHByb2R1Y3QpCiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVByb2R1Y3RzSG9sZChwcm9kdWN0KQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2VlVGF4UHJvZHVjdChwcm9kdWN0KSB7CgogICAgICAgICAgICAgICAgdGhpcy50YXhlcyA9IHByb2R1Y3QudGF4ZXMKICAgICAgICAgICAgICAgIHRoaXMuJGJ2TW9kYWwuc2hvdygndGVzdCcpCgoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRmV0Y2hQcm9kdWN0KGNhdHByb2R1Y3QpewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29wcm9kdWN0JykKCiAgICAgICAgICAgICAgICB0aGlzLkZldGNoUHJvZHVjdHMoY2F0cHJvZHVjdCkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qIG1ha2VUb2FzdCh2YXJpYW50ID0gbnVsbCwgbXNnKSB7CiAgICAgICAgICAgICAgICAgdGhpcy4kYnZUb2FzdC50b2FzdChtc2csIHsKICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGAgJHt2YXJpYW50IHx8ICJkZWZhdWx0In1gLAogICAgICAgICAgICAgICAgICAgICB2YXJpYW50OiB2YXJpYW50LAogICAgICAgICAgICAgICAgICAgICBzb2xpZDogdHJ1ZQogICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgfSwqLwoKICAgICAgICAgICAgbWFrZVRvYXN0KHZhcmlhbnQgPSBudWxsLHR5cGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQbGVhc2UgZmlsbCB0aGUgZm9ybSBjb3JyZWN0bHknLHZhcmlhbnQpCiAgICAgICAgICAgICAgICB0aGlzLiR0b2FzdGVkLnNob3codmFyaWFudCx7dHlwZTp0eXBlfSkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEFkZEhvbGQoKXsKCiAgICAgICAgICAgICAgICB0aGlzLmFkZGhvbGQoKQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2JpbGFuJywgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY29udGFjdHNJZCkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIFJlbW92ZUhvbGQoKXsKCiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5zdGF0ZS5jYWlzc2VzLnN0YXR1c3JlcXVldGUgPSBmYWxzZQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnaGVsbG8nLHRoaXMuc2VsZWN0aG9sZC5udW1iZXIpCgogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVob2xkKHtudW1iZXI6dGhpcy5zZWxlY3Rob2xkLm51bWJlciwKICAgICAgICAgICAgICAgICAgICBjbG9zZTp0cnVlfSkKICAgICAgICAgICAgfSwKCiAgICAgICAgfSwKCiAgICAgICAgbW91bnRlZCgpIHsKCiAgICAgICAgICAgIGlmKHRoaXMuJHN0b3JlLnN0YXRlLmF1dGhEYXRhLnJvbGUuaW5kZXhPZignY29udHJvbGV1cicpICE9PSAtMSl7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYodGhpcy4kc3RvcmUuc3RhdGUuYXV0aERhdGEucm9sZS5pbmRleE9mKCdjZycpICE9PSAtMSl7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuYm94b3BlbiA9IHRoaXMuc3RyaW5nVG9Cb29sZWFuKChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm94b3BlbicpKSk7CiAgICAgICAgICAgIHRoaXMuc2hvdyA9IChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYm94c2hvdycpIT1udWxsKT8odGhpcy5zdHJpbmdUb0Jvb2xlYW4oKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdib3hzaG93JykpKSk6IiIgOwoKCiAgICAgICAgICAgIHRoaXMuY2hlY2tzZXNzaW9uZSgpCiAgICAgICAgICAgIHRoaXMuaG9sZGxpc3RlKCkKCgogICAgICAgICAgICBjb25zb2xlLmxvZyhtb21lbnQoKS5mb3JtYXQoInl5eXktTU0tREQiKSkKICAgICAgICAgICAgY29uc29sZS5sb2coJ2JveG9wZW4nLHRoaXMuYm94b3BlbikKICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvZGVwYXlzJyx0aGlzLmNvZGVwYXlzKQoKICAgICAgICAgICAgdGhpcy5GZXRjaENhdFByb2R1Y3RzKCkKICAgICAgICAgICAgdGhpcy5GZXRjaFNhbGVzUHJvZHVjdHMoe251bWJlcjpsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2VsZWN0aG9sZCIpfSkKCiAgICAgICAgICAgIC8vdGhpcy5jbG9zZUJveCgpCiAgICAgICAgICAgIC8vdGhpcy5zZWFyY2hQYXJ0bmVycyh7dmFsOid0Jyx0eXBlOidjbGllbnRzJ30pCiAgICAgICAgICAgIC8vdGhpcy5GZXRjaENvbnRhY3RzKCkKICAgICAgICAgICAgLy90aGlzLkZldGNoU2VsbGVycygpCiAgICAgICAgICAgIC8vdGhpcy5GZXRjaEN1c3RvbWVycygpCgogICAgICAgIH0sCgogICAgICAgIHdhdGNoOiB7CgoKICAgICAgICAgICAgR2V0Q0hFQ0tTRVNTSU9OOmZ1bmN0aW9uKHZhbHVlKXsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2hlY2tzZXNzaW9uJyx2YWx1ZSkKCiAgICAgICAgICAgICAgICB0aGlzLmJveG9wZW4gPSB0aGlzLnN0cmluZ1RvQm9vbGVhbigobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JveG9wZW4nKSkpCiAgICAgICAgICAgICAgICB0aGlzLnNob3cgPSB0aGlzLnN0cmluZ1RvQm9vbGVhbigobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2JveHNob3cnKSkpCgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Nob3cnLHRoaXMuYm94b3BlbikKCiAgICAgICAgICAgICAgIC8vIHRoaXMuc2hvdyA9IChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYm94c2hvdyIpKT09J3RydWUnCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2hvdycsKHRoaXMuc2hvdykpCgogICAgICAgICAgICB9LAoKCiAgICAgICAgICAgIEdldFJlbW92ZUFsbFByb2R1Y3RzOmZ1bmN0aW9uKHZhbHVlKXsKCgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbW92Jyx2YWx1ZSkKICAgICAgICAgICAgICAgIHRoaXMuc2hvdz1mYWxzZQogICAgICAgICAgICAgICAgaWYodmFsdWU9PT0wKXsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgLy8gdGhpcy5pbnZvaWNlX3RheHM9dGhpcy5pbnZvaWNlX3RheAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdicsdGhpcy5pbnZvaWNlX3RheHMpCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnZNb2RhbC5zaG93KCd0ZXN0cycpCgogICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdHByb2R1Y3RzPVtdCiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0dGF4PVtdCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlX3RheCA9IDAKICAgICAgICAgICAgICAgICAgICB0aGlzLmludm9pY2VUb3RhbCgpCgogICAgICAgICAgICAgICAgICAgIC8qdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY29udGFjdHNJZD0wCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMudmVuZGV1cnNJZD0wCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY2xpZW50c0lkPTAqLwogICAgICAgICAgICAgICAgICAgIHRoaXMuZm9ybS5SZWZlcmVuY2U9IiIKICAgICAgICAgICAgICAgIH1lbHNlIGlmKHZhbHVlPT09MSl7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QodGhpcy4kdCgnZXJyb3InKSwwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2Fpc3Nlcy5yZW1vdmVhbGxwcm9kdWN0cz0yOwoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldENhaXNzZU9wZW46ZnVuY3Rpb24odmFsdWUpewoKICAgICAgICAgICAgICAgIGlmKCF2YWx1ZSkgewoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3cgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ2TW9kYWwuaGlkZSgnY29uZmlybW9wZW5BY2NvdW50JykKICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5iPXRydWUKICAgICAgICAgICAgICAgICAgICB0aGlzLmJveG9wZW4gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJib3hvcGVuIixmYWxzZSkKICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYm94c2hvdyIsZmFsc2UpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5zdGF0ZS5jYWlzc2VzLmNhaXNzZW9wZW49dHJ1ZTsKCiAgICAgICAgICAgICAgICAvKmVsc2V7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0ZGF0dXMnLHZhbHVlKQoKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidk1vZGFsLmhpZGUoJ2NvbmZpcm1jbG9zZUFjY291bnQnKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGRhdHVzJyx2YWx1ZSkKICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYm94b3BlbiIsdmFsdWUpCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgKi8KCgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0Q2F0UHJvZHVjdHM6IGZ1bmN0aW9uKHZhbHVlKXsKCiAgICAgICAgICAgICAgICB0aGlzLmNhdD1bXQogICAgICAgICAgICAgICAgdGhpcy5jYXQgPSB2YWx1ZQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlZ2lzdGVycCcsdmFsdWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qZ2V0UHJvZHVjdHModmFsKXsKICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VhcmNoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93X3JlZmVyID0gIXRoaXMuc2hvd19yZWZlcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Jlc3VsdGwnLHZhbCkKICAgICAgICAgICAgICAgIC8vdGhpcy5tYWtlVG9hc3QoJ3N1Y2VzcycsJ3N1Y2Nlc3MnKQogICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0cz12YWw7CiAgICAgICAgICAgIH0sKi8KICAgICAgICAgICAgZ2V0U3RhdHVzKHZhbHVlKXsKCiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLnJlZ2lzdGVyUGFydG5lcnMucmVnaXN0ZXJwKHZhbHVlKQogICAgICAgICAgICAgICAgaWYodmFsdWUpewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHV0ZT1mYWxzZQogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlZ2lzdGVycCcsdmFsdWUpCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRiKCl7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ib3hvcGVuCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRDdXN0b21lcih2YWwpewoKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHV0ZT1mYWxzZQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXR1dGUnLHRoaXMudmFyaWFudCkKCiAgICAgICAgICAgICAgICAvL3VzZUF1dG9jb21wbGV0ZSgpLnN0YXRlLnVzZXJJbnB1dD0iaGVsbG8iCgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXR1dGUnLHZhbCkKICAgICAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKHZhbCkubGVuZ3RoICE9PSAwKSB7CgoKICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnZhcmlhbnQudmFyaWFudCA9PT0gImNhaXNzZS9jbGllbnRzIil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ2TW9kYWwuaGlkZSgncmVnaXN0ZXJjdXN0b21lcicpCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50cy5wdXNoKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QodGhpcy4kdCgnY3VzdG9tZXJfYWRkJyksJ3N1Y2Nlc3MnKQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52YXJpYW50LnZhcmlhbnQgPT09ICJjYWlzc2UvY29udGFjdHMiKXsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ2TW9kYWwuaGlkZSgncmVnaXN0ZXJjb250YWN0JykKCgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmNvbnRhY3RzLnB1c2godmFsKQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1ha2VUb2FzdCh0aGlzLiR0KCdjb250YWN0X2FkZCcpLCdzdWNjZXNzJykKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudmFyaWFudC52YXJpYW50ID09PSAiY2Fpc3NlL3ZlbmRldXJzIil7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ2TW9kYWwuaGlkZSgncmVnaXN0ZXJzZWxsZXInKQogICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY2xpZW50cy5wdXNoKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QodGhpcy4kdCgnc2VsbGVyc19hZGQnKSwnc3VjY2VzcycpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidk1vZGFsLm1zZ0JveE9rKCcnLCkKCgogICAgICAgICAgICAgICAgfWVsc2V7CgogICAgICAgICAgICAgICAgICAgIC8vdGhpcy5zaG93PWZhbHNlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlVG9hc3QodGhpcy4kdCgnY3VzdG9tZXJfZGVuaWVkJyksICJlcnJvciIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdldEJveCh2YWwpewogICAgICAgICAgICAgICAgdGhpcy5ib3g9dmFsOwoKICAgICAgICAgICAgICAgIGlmKHZhbCl7CgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlbmNhaXNzJyx0aGlzLmhvbGRsaXN0Lmxlbmd0aCkKCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5ob2xkbGlzdC5sZW5ndGg+MSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdz1mYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlY2Fpc3NlKCkKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQWxsUHJvZHVjdHNIb2xkKHtudW1iZXI6dGhpcy5zZWxlY3Rob2xkLm51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25DYWlzc2VJZDpsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2Vzc2lvbmNhaXNzZSIpfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuYm94ID0gZmFsc2UKCiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3c9ZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgLy8gdGhpcy5ib3g9ZmFsc2U7CgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgR2V0RW5jYWlzc2VtZW50cyh2YWwpewoKICAgICAgICAgICAgICAgIHRoaXMuZW5jYWlzc2VtZW50cz12YWwKCgkJCQl0aGlzLm51bWVyb2NsaWVudCA9ICIiCgkJCQl0aGlzLm51bWVyb2NvbnRhY3RzID0gIiIKCQkJCXRoaXMuZm9ybS5SZWZlcmVuY2UgPSAiIgoKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3NldHJlZmVyZW5jZScsIiIpCgogICAgICAgICAgICAgICAgdGhpcy5maWVsZCA9IHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLmNvbnRhY2NsdAogICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuY2F0ZWdvcmllcHJvZHVjdHMuY29udGFjdHNJZD0wCiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy52ZW5kZXVyc0lkPTAKICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLmNsaWVudHNJZD0wCgogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnZXJhc2UnLHt2YWw6J2NvbnRhY3RzJ30pCgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VuYzUnLHZhbCkKICAgICAgICAgICAgICAgIHRoaXMucmVzZXRXaW5kb3dzKCkKICAgICAgICAgICAgICAgIC8vdXNlQXV0b2NvbXBsZXRlKCkuc3RhdGUudXNlcklucHV0PSIiCgogICAgICAgICAgICB9LAoKCiAgICAgICAgICAgIEdFVEJJTEFOKHZhbCl7CgogICAgICAgICAgICAgICAgdGhpcy5iaWxhbj12YWwKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdiaWxhbicsdmFsKQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0T2JqZXRIb2xkKHZhbCl7CgogICAgICAgICAgICAgICAgLy90aGlzLnNlbGVjdGhvbGQgPSB2YWwKICAgICAgICAgICAgICAgIHRoaXMuaG9sZGxpc3QucHVzaCh2YWwpOwoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0U3RhdHVzSG9sZCh2YWwpewoKICAgICAgICAgICAgICAgIGlmKHZhbD09PTIwMCl7CiAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4SWRzID0gdGhpcy5jaGVja0lkSG9sZCh0aGlzLmhvbGRsaXN0LHRoaXMuc2VsZWN0aG9sZC5ob2xkSWQpCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29iamV0c2hvbGQnLGluZGV4SWRzKQoKICAgICAgICAgICAgICAgICAgICB0aGlzLmhvbGRsaXN0LnNwbGljZShpbmRleElkcywgMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5ob2xkbGlzdC5zb3J0KCk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldEhvbGRMaXN0KHZhbCl7CiAgICAgICAgICAgICAgICB0aGlzLmhvbGRsaXN0PVtdCiAgICAgICAgICAgICAgICB0aGlzLmhvbGRsaXN0PXZhbDsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaG9sZGxpc3RlcycsdGhpcy5ob2xkbGlzdCkKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaG9sZHRlcycsbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNlbGVjdGhvbGQiKSkKICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aG9sZCA9IHRoaXMuaG9sZGxpc3RbMF0KCiAgICAgICAgICAgICAgICAvKmlmKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzZWxlY3Rob2xkIikgPT09ICdudWxsJyB8fCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2VsZWN0aG9sZCIpID09PSBudWxsICl7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aG9sZCA9IHRoaXMuaG9sZGxpc3RbMF0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaG9sZGxpc3QnLHRoaXMuaG9sZGxpc3RbMF0pCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoT2JqZWN0LmtleXMobG9jYWxTdG9yYWdlLmdldEl0ZW0oInNlbGVjdGhvbGQiKSkubGVuZ3RoICE9PSAwKXsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rob2xkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNlbGVjdGhvbGQiKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdob2xkbGlzJyx0aGlzLnNlbGVjdGhvbGQpCgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoaGhoJyx0aGlzLnNlbGVjdGhvbGQpKi8KICAgICAgICAgICAgICAgIHRoaXMuU2VsZWN0SG9sZHModGhpcy5zZWxlY3Rob2xkKQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0U2VsZWN0SG9sZCh2YWwpewoKICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0aG9sZCA9IHZhbAoKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzZWxlY3Rob2xkIix2YWwpCgogICAgICAgICAgICAgICAgLy90aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy5jb250YWN0c0lkPTAKICAgICAgICAgICAgICAgIC8vIHRoaXMuJHN0b3JlLnN0YXRlLmNhdGVnb3JpZXByb2R1Y3RzLnZlbmRldXJzSWQ9MAogICAgICAgICAgICAgICAgLy90aGlzLiRzdG9yZS5zdGF0ZS5jYXRlZ29yaWVwcm9kdWN0cy5jbGllbnRzSWQ9MAogICAgICAgICAgICAgICAgdXNlQXV0b2NvbXBsZXRlKCkuc3RhdGUudXNlcklucHV0PSIiCgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Nvb29vYmpldGhvbGQnLHZhbCkKICAgICAgICAgICAgICAgIHRoaXMuZ2V0UHJvZHVjdHNIb2xkKHRoaXMuc2VsZWN0aG9sZCkKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdldFByb2R1Y3RzSG9sZCh2YWwpewoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnZXRwJyx2YWwpCgogICAgICAgICAgICAgICAgLy90aGlzLmxpc3Rwcm9kdWN0cyA9IHZhbAogICAgICAgICAgICAgICAgdGhpcy5saXN0cHJvZHVjdHM9W10KICAgICAgICAgICAgICAgIHRoaXMubGlzdHRheD1bXQoKICAgICAgICAgICAgICAgIGlmKHZhbC5sZW5ndGghPTApIHsKICAgICAgICAgICAgICAgICAgICB2YWwuZm9yRWFjaCgodmFsdWUpID0+IHsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdHByb2R1Y3RzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVpdElkOiB2YWx1ZS5wcm9kdWl0LnByb2R1aXRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpYmVsbGU6IHZhbHVlLnByb2R1aXQubGliZWxsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogdmFsdWUucmVmZXJlbmNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9sZElkOiB0aGlzLnNlbGVjdGhvbGQuaG9sZElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpeDogdmFsdWUucHJvZHVpdC5wcml4LC8vdGhpcy5hcHBseVRheCh2YWx1ZS5wcm9kdWl0LnByaXgsdmFsdWUudGF4ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWU6IHZhbHVlLnByb2R1aXQuY2F0ZWdvcmllUHJvZHVpdC5saWJlbGxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb25DYXQ6IHZhbHVlLnByb2R1aXQuY2F0ZWdvcmllUHJvZHVpdC5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRheGVzOiB2YWx1ZS50YXhlcwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdHRheCAgPSB2YWx1ZS50YXhlcwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRheFRvdGFsKHZhbHVlLnByb2R1aXQucHJpeCwiKyIpCgogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW52b2ljZV90YXggID0gMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlVG90YWwoKQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE1vdmVQcm9kdWN0c0hvbGQodmFsdWUpewoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtb3ZlZicsdmFsdWUpCiAgICAgICAgICAgICAgICB0aGlzLmZvcmNhcmQgPSBmYWxzZQoKICAgICAgICAgICAgICAgIHZhciBvcGVyYW5kZSA9IiIKICAgICAgICAgICAgICAgIGlmKHZhbHVlLnN0YXR1dD09PTApIHsKCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUuc3VjY2Vzcyl7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3Rwcm9kdWN0cy5yZWZlcmVuY2UgPSB0aGlzLmZvcm0uUmVmZXJlbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhbmRlID0gIisiCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdHByb2R1Y3RzLnB1c2goewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1aXRJZDogdmFsdWUucHJvZHVpdC5wcm9kdWl0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJlbGxlOiB2YWx1ZS5wcm9kdWl0LmxpYmVsbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2U6IHRoaXMubGlzdHByb2R1Y3RzLnJlZmVyZW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvbGRJZDogdGhpcy5zZWxlY3Rob2xkLmhvbGRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaXg6IHZhbHVlLnByb2R1aXQucHJpeCwvL3RoaXMuYXBwbHlUYXgodmFsdWUucHJvZHVpdC5wcml4LHZhbHVlLnRheGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllOiB2YWx1ZS5wcm9kdWl0LmNhdGVnb3JpZVByb2R1aXQubGliZWxsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uQ2F0OiB2YWx1ZS5wcm9kdWl0LmNhdGVnb3JpZVByb2R1aXQuZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXhlczogdmFsdWUudGF4ZQoKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMuZm9ybS5SZWZlcmVuY2UgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLm1hdHJpY3VsZS5yZXNldGZpZWxkKCkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobmV3IEludGwuTnVtYmVyRm9ybWF0KCdDTScsIHsgc3R5bGU6ICdjdXJyZW5jeScsIGN1cnJlbmN5OiAnWEFGJyB9KS5mb3JtYXQodmFsdWUucHJvZHVpdC5wcml4KSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZighdmFsdWUudGF4ZS5pbmNsdXNlKXsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3R0YXggPSB2YWx1ZS50YXhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbW92ZWUnLCB0aGlzLmxpc3R0YXgpCgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhbmRlPSIrIjsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50YXhUb3RhbCh2YWx1ZS5wcm9kdWl0LnByaXgsb3BlcmFuZGUpCgogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncHJ4eHhvZHVjdHMnLHZhbHVlLm1lc3NhZ2UuY29kZSkKICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVRvYXN0KHRoaXMuJHQodmFsdWUubWVzc2FnZS5jb2RlKSx0aGlzLiR0KHZhbHVlLm1lc3NhZ2UubGV2ZWwpKQogICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMubWFrZVRvYXN0KHRoaXMuJHQodmFsdWUubWVzc2FnZS5jb2RlKSwnZXJyb3InKQoKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vb2J0ZW5pciBvYmplY3QgcGFyIHNvbiBpZAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9ZWxzZXsKCiAgICAgICAgICAgICAgICAgICAgb3BlcmFuZGU9Ii0iOwoKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdjaGVja2lkJyx0aGlzLmNoZWNrSWQodGhpcy5saXN0cHJvZHVjdHMsdmFsdWUucmVmZXJlbmNlKSkKICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXhJZCA9IHRoaXMuY2hlY2tJZCh0aGlzLmxpc3Rwcm9kdWN0cyx2YWx1ZS5yZWZlcmVuY2UpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0dGF4ID0gKHRoaXMubGlzdHByb2R1Y3RzW2luZGV4SWRdKS50YXhlcwoKCiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXhUb3RhbCh0aGlzLmxpc3Rwcm9kdWN0c1tpbmRleElkXS5wcml4LG9wZXJhbmRlKQogICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdHByb2R1Y3RzLnNwbGljZShpbmRleElkLCAxKTsKCgoKICAgICAgICAgICAgICAgIH0KCgogICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlVG90YWwoKQoKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldEJveE9wZW4odmFsdWUpewoKCiAgICAgICAgICAgICAgICBpZighdmFsdWUpIHsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlYj10cnVlCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYnZNb2RhbC5oaWRlKCdjb25maXJtb3BlbkFjY291bnQnKQoKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2ViPXRydWUKICAgICAgICAgICAgICAgICAgICB0aGlzLiRidk1vZGFsLmhpZGUoJ2NvbmZpcm1jbG9zZUFjY291bnQnKQoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3cgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3hvcGVuPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHRoaXMuYm94b3Blbj0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGRhdHVzJyx2YWx1ZSkKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rob2xkPXt9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5saXN0cHJvZHVjdHM9W10KICAgICAgICAgICAgICAgICAgICB0aGlzLmxpc3R0YXg9W10KICAgICAgICAgICAgICAgICAgICB0aGlzLmludm9pY2VUb3RhbCgpCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlX3RheCA9IDAKICAgICAgICAgICAgICAgICAgICB0aGlzLmhvbGRsaXN0PVtdCgoKICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYm94b3BlbiIsdHJ1ZSkKICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYm94c2hvdyIsdHJ1ZSkKCgogICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0b3JlLnN0YXRlLmNhaXNzZXMuYm94b3BlbnM9ZmFsc2UKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRidk1vZGFsLnNob3coJ2JpbGFuJykKCiAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICB9Owo="},{"version":3,"sources":["box.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0fA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;AAGA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;AAGA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;AAGA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;;AAGA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;;AAGA;AACA;;;;AAIA;;;AAGA;;AAEA;;AAEA;;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;;AAGA;AACA;;AAEA;;;AAGA;AACA;AACA","file":"box.vue","sourceRoot":"src/views/app/caisses","sourcesContent":["<template>\r\n\r\n    <div class=\"main-content\">\r\n\r\n        <salesreceipt :encaissements=\"encaissements\"\r\n                      :encompte=\"encompte\"\r\n                      :box=\"box\"\r\n                      :invoice_tax =\"invoice_taxs\"\r\n                      :field=\"field\"\r\n                      :codepays=\"codepays\"\r\n                      :devise=\"devise\"\r\n                      :listproducts=\"listproducts\"\r\n                      :country=\"country\"\r\n                      @print=\"print\"\r\n        @cancels=\"cancels\"></salesreceipt>\r\n\r\n\r\n        <bilan :data=\"bilan\"></bilan>\r\n\r\n        <b-button  style=\"right: 0;position: absolute\" v-if=\"boxopen===true\" pill variant=\"success m-1\"\r\n                   @click =\"openmodalbox\"  ><i class=\"i-Folder-Open\"></i>\r\n        </b-button>\r\n\r\n        <b-button  style=\"right: 0;position: absolute\" v-else pill variant=\"danger m-1\" @click =\"closemodalbox\" >\r\n            <i class=\"i-Close\"></i></b-button>\r\n\r\n        <b-col md=\"12\" style=\"position:relative;text-align: right\" >\r\n            <!--{{$t('close_box')}}-->\r\n\r\n            <b-overlay :show=\"openb\" rounded=\"sm\" >\r\n\r\n                <b-modal id=\"confirmopenAccount\" :title=\"$t('open_box')\" hide-footer>\r\n\r\n                <template #modal-header=\"{}\">\r\n                    <!-- Emulate built in modal header close button action -->\r\n                    <h5>{{$t('open_box')}}</h5>\r\n                </template>\r\n\r\n                <template #default=\"{  }\">\r\n\r\n                    <b-form-input\r\n\r\n                            v-model=\"ouvertureAmount\"\r\n                            type=\"number\"\r\n                            :placeholder=\"$t('Montant_Encaisse')\"\r\n                    ></b-form-input>\r\n                    <p></p>\r\n                    <div style=\"text-align: right\">\r\n                        <b-button  :disabled=\"!openb\" @click=\"openBox()\" variant=\"outline-success\" style=\"margin-right: 15px\">{{$t('open')}}</b-button>\r\n                    </div>\r\n\r\n                </template>\r\n\r\n                </b-modal>\r\n\r\n            </b-overlay>\r\n\r\n            <!--<b-overlay :show=\"closeb\" rounded=\"sm\" >-->\r\n\r\n             <b-modal id=\"confirmcloseAccount\"  title=\"Confirmer la fermeture de la Caisse\" hide-footer>\r\n                <p></p>\r\n\r\n                <template #default=\"{}\">\r\n\r\n                    <b-form-input\r\n                            v-model=\"ouvertureAmount\"\r\n                            type=\"number\"\r\n                            :placeholder=\"$t('Montant_Close')\"\r\n\r\n                    ></b-form-input>\r\n\r\n\r\n                    <p></p>\r\n\r\n                    <div style=\"text-align: right\">\r\n                        <b-button :disabled=\"!closeb\" type=\"submit\" variant=\"outline-success rights\"\r\n                                  @click=\"closeBox()\" >{{$t('close')}}</b-button>\r\n                    </div>\r\n\r\n                </template>\r\n\r\n            </b-modal>\r\n\r\n            <!--</b-overlay>-->\r\n\r\n        </b-col>\r\n\r\n        <breadcumb :page=\"$t('caisse')\" :folder=\"date\"   /> <!--:montant=\"\"-->\r\n\r\n        <b-overlay :show=\"show\" rounded=\"sm\" >\r\n\r\n            <b-card  :aria-hidden=\"show ? 'true' : null\"  class=\"overlay-box\">\r\n                <!--title=\"Form Inputs\"-->\r\n\r\n\r\n                <b-row>\r\n                    <b-col md=\"5\">\r\n\r\n\r\n                        <b-row>\r\n                            <Catproductes :cats=\"cat\"  @FetcProduct=\"FetchProduct\"></Catproductes>\r\n                        </b-row>\r\n                        <p></p>\r\n\r\n\r\n                        <b-row>\r\n\r\n                            <b-form-group\r\n                                    class=\"col-md-10 mb-30\"\r\n                                    :label=\"$t('Reference')\"\r\n                                    label-for=\"input-1\"\r\n\r\n                            >\r\n                                <reference\r\n                                          ref=\"matricule\"\r\n                                          :formattedreferenceValue=\"form.Reference\"\r\n                                           @setlistpr=\"setlistpr\" @setrefoverlay=\"setoverlay\"\r\n                                           @setreference=\"setreference\"></reference>\r\n\r\n\r\n                            </b-form-group>\r\n\r\n                            <div class=\"spinner spinner-info\" v-if=\"show_refer\"\r\n                                 style=\"position:absolute;margin-top:29px!important;\r\n                             margin-left:33px!important;\r\n                             width:15px;height:15px;\"></div>\r\n                            <!--<div class=\"col-md-1\" >\r\n\r\n                                <button class=\"btn btn-outline-success  btn-icon m-1\" @click=\"searchreference()\"\r\n                                        style=\"margin-top:25px!important;padding:4px!important;\" type=\"button\">\r\n                                    <span class=\"ul-btn__icon\"><i class=\"i-Search-People\"></i></span></button>\r\n\r\n                            </div>-->\r\n\r\n                        </b-row>\r\n\r\n                        <b-overlay :show=\"forcard\" rounded=\"sm\" >\r\n                            <b-row class=\"scroll-card\">\r\n\r\n                                <b-card no-body v-for=\"item in products\" :key=\"item.produit.produitId\"  @click=\"Addcat(item)\"\r\n                                    class=\"bg-dark text-white o-hidden mb-30 taille \" style=\"margin-left:28px!important;\">\r\n\r\n                                <img v-if=\"item.produit.img==null\" src=\"../../../assets/images/photo-long-1.jpg\" alt />\r\n\r\n\t\t\t\t\t\t\t\t<img v-else :src=\"resources_urls + item.produit.img\" alt />\r\n                                <!--<img v-if=\"item.produit.img==null\" v-auth-image=\"../../../assets/images/photo-long-1.jpg\" alt>\r\n                                <img v-else v-auth-image=\"../../../assets/images/photo-long-1.jpg\" alt />-->\r\n\r\n                                <div class=\"card-img-overlay\">\r\n                                    <div class=\"text-center pt-4\">\r\n                                        <h5 class=\"card-title mb-2 text-white \" style=\"font-size: 13px\">{{$t(item.produit.libelle )}}</h5>\r\n                                        <div class=\"separator border-top mb-2\"></div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                            </b-card>\r\n\r\n                            </b-row>\r\n                        </b-overlay>\r\n\r\n                    </b-col>\r\n                    <b-col md=\"7\">\r\n                        <b-row>\r\n                            <b-form-group\r\n                                    class=\"col-md-7 mb-30\"\r\n                                    :label=\"$t('Client')\"\r\n                                    label-for=\"input-1\"\r\n                            >\r\n                                <AutoComplete ref=\"childAutos\" @save-change=\"savechange\" msg='clients' type='caisse' :optionsKey=\"optionsKey\"\r\n                                               :optionsKey1=\"optionsKey1\"></AutoComplete><!---->\r\n\r\n\r\n                            </b-form-group>\r\n\r\n                            <b-form-group\r\n                                    style=\"margin-right: 0 !important;\"\r\n                                    class=\"col-md-5 mb-30\"\r\n                                    :label=\"$t('numero')\"\r\n                                    label-for=\"input-1\"\r\n                            >\r\n\r\n                                <b-form-input\r\n                                        autocomplete=\"off\"\r\n                                        type=\"text\"\r\n                                        v-model=\"numeroclient\"\r\n                                        @input=\"clientsupdate\"\r\n                                        placeholder=\"\"\r\n                                        size=\"sm\"\r\n                                ></b-form-input>\r\n\r\n                            </b-form-group>\r\n                        </b-row>\r\n                        <b-row>\r\n                            <b-form-group\r\n                                    class=\"col-md-7 mb-30\"\r\n                                    :label=\"$t('Contact')\"\r\n                                    label-for=\"input-1\"\r\n                            >\r\n                                <!--ref='contacts'-->\r\n                                <AutoComplete\r\n                                        ref=\"childAuto\" @save-change=\"savechange\"  type='caisse' msg='contacts' :optionsKey=\"optionsKey\" :optionsKey1=\"optionsKey1\" ></AutoComplete>\r\n\r\n                            </b-form-group>\r\n                            <b-form-group\r\n                                    style=\"margin-right: 0 !important;\"\r\n                                    class=\"col-md-5 mb-30\"\r\n                                    :label=\"$t('numero')\"\r\n                                    label-for=\"input-1\"\r\n                            >\r\n\r\n                                <b-form-input\r\n                                        autocomplete=\"off\"\r\n                                        type=\"text\"\r\n                                        @input=\"contactsupdate\"\r\n                                        v-model=\"numerocontacts\"\r\n                                        placeholder=\"\"\r\n                                        size=\"sm\"\r\n                                ></b-form-input>\r\n\r\n                            </b-form-group>\r\n\r\n\r\n\r\n                        </b-row>\r\n                        <b-row>\r\n                            <b-col >\r\n                                <table class=\"table table-bordered\">\r\n                                    <thead>\r\n                                    <tr>\r\n                                        <th scope=\"col\" v-for=\"header in fields\" :key=\"header\">\r\n                                            {{$t(header)}}\r\n                                        </th>\r\n                                    </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                    <tr v-if=\"listproducts.length === 0\">\r\n                                        <td colspan=\"5\" md=\"12\">{{$t('no_product')}}</td>\r\n                                    </tr>\r\n                                    <tr v-else v-for=\"item in listproducts\"  :key=\"item.produit_id\">\r\n\r\n                                        <td>{{item.libelle}}</td>\r\n                                        <td>\r\n\r\n                                            <input\r\n                                                    class=\"form-control\"\r\n                                                    type=\"text\"\r\n                                                    v-model=\"item.reference\"\r\n                                                    placeholder=\"Reference\"\r\n                                            />\r\n                                        </td>\r\n\r\n                                        <td>\r\n\r\n                                            <select class=\"form-control\"\r\n                                                    name=\"document\"\r\n                                                    id=\"document\"\r\n                                                    v-model=\"document\"\r\n                                            >\r\n\r\n                                                <!--<option :value=\"marques2.marqueVehiculeId\" selected>{{marques2.libelle}}</option>-->\r\n                                                <option value=\"cg\">\r\n                                                    Carte grise\r\n                                                </option>\r\n                                                <!--<option value=\"cerfvente\">\r\n                                                    Certification de vente\r\n                                                </option>-->\r\n                                                <option value=\"cerfimma\">\r\n                                                    Certification Immatriculation\r\n                                                </option>\r\n                                                <option value=\"civio\">\r\n                                                    CIVIO\r\n                                                </option>\r\n                                                <option value=\"autres\">\r\n                                                    autres\r\n                                                </option>\r\n\r\n                                            </select>\r\n                                        </td>\r\n\r\n                                        <td>{{ item.prix | currencys(codepays,devise) }}</td>\r\n                                        <td><a\r\n                                                @click=\"SeeTaxProduct(item)\"\r\n                                                class=\"o-hidden d-inline-block\"\r\n                                                title=\"See Tax\"\r\n                                        >\r\n                                            <i class=\"i-Eye-Visible text-25 text-success\"></i>\r\n                                        </a></td>\r\n                                        <td><a\r\n                                                @click=\"removeCatProducts(item)\"\r\n                                                class=\"o-hidden d-inline-block\"\r\n                                                title=\"Delete\"\r\n                                        >\r\n                                            <i class=\"i-Close-Window text-25 text-danger\"></i>\r\n                                        </a></td>\r\n                                    </tr>\r\n                                    </tbody>\r\n                                </table>\r\n\r\n                            </b-col>\r\n\r\n\r\n                            <b-col md=\"12\">\r\n                                <div class=\"invoice-summary float-right\" style=\"width: 300px !important\">\r\n                                    <p>\r\n                                        {{$t('Montant_total')}}:\r\n                                        <span>{{Montant_total|currencys(codepays,devise)}}</span>\r\n                                    </p>\r\n\r\n                                    <p>\r\n                                        {{$t('Taxes')}}:\r\n                                        <span> {{invoice_tax|currencys(codepays,devise)}} </span>\r\n                                    </p>\r\n\r\n                                    <h5 class=\"font-weight-bold\">\r\n                                        {{$t('Net_a_Payer')}}:\r\n                                        <span> {{invoice_total|currencys(codepays,devise)}} </span>\r\n\r\n                                    </h5>\r\n\r\n                                </div>\r\n                            </b-col>\r\n                        </b-row>\r\n\r\n                        <p></p>\r\n                        <b-row>\r\n\r\n                            <b-col md=\"3\"></b-col>\r\n                            <b-col md=\"5\" style=\"visibility: hidden\"><h5><b>{{$t('Montant_Encaisse')}}:</b></h5></b-col>\r\n                            <b-col md=\"4\" style=\"visibility: hidden\">\r\n                                <b-form-input\r\n\r\n                                        v-model=\"form.montant_encaisse\"\r\n                                        disabled\r\n                                        type=\"number\"\r\n                                        required\r\n                                        placeholder=\"0\"\r\n                                ></b-form-input></b-col>\r\n\r\n                        </b-row>\r\n\r\n\r\n\r\n                    </b-col>\r\n                </b-row>\r\n\r\n                <p></p>\r\n                <p></p>\r\n                <p></p>\r\n                <p></p>\r\n                <b-row >\r\n                    <b-col md=\"6\"></b-col>\r\n                    <!--<b-col md=\"6\">\r\n                        <b-row>\r\n                            <b-form-group\r\n                                    class=\"col-md-10 mb-30\"\r\n                                    :label=\"$t('Contact')\"\r\n                                    label-for=\"input-1\"\r\n                            >\r\n                                <AutoComplete ref='contacts' type='caisse' msg='contacts' :optionsKey=\"optionsKey\" :optionsKey1=\"optionsKey1\" ></AutoComplete>\r\n\r\n                            </b-form-group>\r\n\r\n                            <div class=\"bv-no-focus-ring \" style=\"margin-top: 17px;\">\r\n\r\n                                <button class=\"btn btn-outline-success  btn-icon m-1\" v-b-modal.registercontact\r\n                                        style2=\"margin-top:5px!important;padding:4px!important;\" type=\"button\">\r\n                                    <span class=\"ul-btn__icon\"><i class=\"i-Add\"></i></span></button>\r\n\r\n                                <registerPartners\r\n                                        id=\"registercontact\"\r\n                                        :title=\"$t('register_contacts')\"\r\n                                        :showpartners=\"statute\"\r\n                                        type=\"caisse/contacts\"\r\n                                        ref=\"registerPartners\"\r\n                                        @registerpartners=\"registerCustomer\"\r\n                                ></registerPartners\r\n                                >\r\n\r\n\r\n                            </div>\r\n\r\n                        </b-row>\r\n                    </b-col>-->\r\n\r\n                    <b-col md=\"6\" style=\"position:relative;text-align: right;margin-top: 19px\" >\r\n\r\n                        <b-button pill variant=\"grey m-1\" style=\"border:1px solid grey ;border-radius: 3px;visibility: hidden\"\r\n                                  @click=\"launchAccount()\">{{$t('Mis_en_Compte')}}</b-button>\r\n                        <b-button pill variant=\"danger m-1 \" @click=\"closecaisse()\" >{{$t('Annuler')}}</b-button>\r\n\r\n\r\n\r\n                        <b-modal id=\"confirminAccount\" scrollable no-close-on-backdrop title=\"Confirmer la mise en Compte\" hide-footer>\r\n                            <p></p>\r\n                            <div style=\"text-align: right\">\r\n                                <b-button  variant=\"outline-danger\"  style=\"visibility: hidden;margin-right: 10px\">{{$t('Annuler')}}</b-button>\r\n                                <b-button type=\"submit\" variant=\"outline-success rights\" @click=\"inAccount()\" >{{$t('Enregistrer')}}</b-button>\r\n\r\n                            </div>\r\n                        </b-modal>\r\n\r\n\r\n                        <b-modal id=\"confirminBox\" scrollable no-close-on-backdrop title=\"Confirmer l'Encaissement\" hide-footer>\r\n                            <p></p>\r\n                            <div style=\"text-align: right\">\r\n                                <b-button  variant=\"outline-danger\"  style=\"visibility: hidden;margin-right: 10px\">{{$t('Annuler')}}</b-button>\r\n                                <b-button type=\"submit\" variant=\"outline-success rights\" @click=\"inBox()\" >{{$t('Encaisser')}}</b-button>\r\n\r\n                            </div>\r\n                        </b-modal>\r\n\r\n\r\n                        <!--<b-button pill variant=\"success m-1\" v-b-modal.confirminBox >{{$t('Encaisser')}}</b-button>-->\r\n                        <b-button pill variant=\"success m-1\" @click=\"launchBox()\" >{{$t('Encaisser')}}</b-button>\r\n\r\n                    </b-col>\r\n\r\n                </b-row>\r\n\r\n                <b-row>\r\n                    <b-col md=\"6\" style=\"position:relative;text-align: left\" >\r\n                        <div class=\"row row-horizon\">\r\n\r\n                           <span class=\"holdList\">\r\n                              <!-- list Holds goes here -->\r\n                               <span class=\"Hold \" :class=\"[item.holdId == selecthold.holdId ? 'selectedHold' : '']\" id=\"item.holdId\" v-for=\"item in holdlist\"\r\n                                     :key=\"item.hold_id\" @click=\"SelectHold(item)\">\r\n\r\n                                   {{item.number}}<!--<span id=\"Time\">{{item.time}}</span>-->\r\n\r\n                               </span>\r\n                           </span>\r\n                            <span class=\"Hold pl\" @click=\"AddHold()\">+</span>\r\n                            <span class=\"Hold pl\" @click=\"RemoveHold()\">-</span>\r\n\r\n\r\n                            <!--<b-tabs pills justified>\r\n                                <b-tab :title=\"item.number\" v-for=\"item in holdlist\" :key=\"item.hold_id\" @click=\"SelectHold(item)\" active>\r\n\r\n                                </b-tab>\r\n\r\n                            </b-tabs>-->\r\n                        </div>\r\n                    </b-col>\r\n                </b-row>\r\n\r\n\r\n            </b-card>\r\n        </b-overlay>\r\n\r\n        <b-modal id=\"test\" title=\"Liste des Taxes\" hide-footer>\r\n\r\n            <template #modal-header=\"{  }\">\r\n                <!-- Emulate built in modal header close button action -->\r\n                <h5>{{$t('tax_list')}}</h5>\r\n            </template>\r\n\r\n            <template #default=\"{ hide }\">\r\n                <table class=\"table table-bordered\">\r\n                    <thead>\r\n                    <tr>\r\n                        <th scope=\"col\" >\r\n                            {{$t('nom_label')}}\r\n                        </th>\r\n                        <th scope=\"col\" >\r\n                            {{$t('description')}}\r\n                        </th>\r\n                        <th scope=\"col\" >\r\n                            {{$t('value')}}\r\n                        </th>\r\n                        <th scope=\"col\" >\r\n                            {{$t('type')}}\r\n                        </th>\r\n\r\n                    </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                    <tr v-if=\"taxes.length === 0\">\r\n                        <td md=\"12\"></td>\r\n                    </tr>\r\n                    <tr v-else v-for=\"item in taxes\"  :key=\"item.taxeId\">\r\n\r\n                        <td>{{item.nom}}</td>\r\n                        <td>{{item.description}}</td>\r\n                        <td>{{item.valeur}}</td>\r\n\r\n                        <td v-if=\"item.incluse == true\">{{$t('incluse')}}</td>\r\n                        <td v-else>{{$t('excluse')}}</td>\r\n                    </tr>\r\n                    </tbody>\r\n                </table>\r\n                <p></p>\r\n                <div style=\"text-align: right\">\r\n                    <b-button  @click=\"hide()\" variant=\"outline-danger\" style=\"margin-right: 15px\">{{$t('close')}}</b-button>\r\n                </div>\r\n\r\n            </template>\r\n\r\n        </b-modal>\r\n    </div>\r\n\r\n</template>\r\n\r\n\r\n<script>\r\n\r\n    import AutoComplete from \"./Autocomplete\"\r\n    import useAutocomplete from '../../../store/modules/useAutocomplete'\r\n    import Catproductes from \"./catproductes\"\r\n    import salesreceipt from \"./salesreceipt\"\r\n    import bilan from \"../components/bilan\"\r\n    //import registerPartners from \"../components/registerpartners\"\r\n    import reference from \"../components/reference\"\r\n    import moment from 'moment'\r\n    import constants from '../../../plugins/constants'\r\n    import { mapGetters,mapActions } from \"vuex\";\r\n\r\n\r\n    //import Vue from 'vue'\r\n    import { makeToast } from '../../../plugins/functions'\r\n\r\n\r\n    export default {\r\n\r\n        metaInfo: {\r\n            title: \"Caisse\"\r\n        },\r\n\r\n        data() {\r\n            return {\r\n\r\n                numerocontacts:\"\",\r\n                forcard:false,\r\n                openb:true,\r\n                closeb:true,\r\n                chassi:\"chassis\",\r\n                selectholdvar:false,\r\n                resources_urls:constants.resource_urls,\r\n                date: new Date().toLocaleString(),\r\n                cat:[],\r\n                userinput:\"\",\r\n                boxopen:false,\r\n                contactsId:5,\r\n                box:false,\r\n                modaltax:false,\r\n                encaissements:{},\r\n                bilan:{},\r\n\r\n                form: {\r\n                    num_ticket:'123',\r\n                    montant_encaisse:0,\r\n                    Reference:\"hello\",\r\n                    name: \"\",\r\n                    email: \"\",\r\n                    emails: \"\",\r\n                    fName: \"\",\r\n                    lName: \"\",\r\n                    phone: \"\"\r\n                },\r\n                ouvertureAmount:0,\r\n                resultsearch:[],\r\n                selection:[],\r\n                Montant_total:0,\r\n                invoice_tax: 0,\r\n                invoice_taxs: 0,\r\n                invoice_total: 0,\r\n                showModal:true,\r\n                clients:[],\r\n                products:[],\r\n                show:false,\r\n                customerForm:\r\n                    {\r\n                        cni: \"\",\r\n                        nom: \"\",\r\n                        prenom: \"\",\r\n                        phone: \"\",\r\n                        status: false,\r\n                        birthday:\"\",\r\n                        passport:\"\",\r\n                        permi_de_conduire:\"\",\r\n                        date: new Date().toLocaleString(),\r\n                    }\r\n                ,\r\n                search:false,\r\n                contact:{\r\n                    Name:\"\"\r\n                },\r\n                vendeur:{\r\n                    Name:\"\"\r\n                },\r\n                document:\"cg\",\r\n                variant:\"\",\r\n                country:this.$store.state.authData.country,\r\n                listproducts:[\r\n                ],\r\n                listtax:[\r\n                ],\r\n                tax:[],\r\n                statute:false,\r\n                show_refer:false,\r\n                selecthold:{},\r\n                taxes:[],\r\n                selected:[],\r\n                optionsKey:\"nom\",\r\n                optionsKey1:\"prenom\",\r\n                fields: [\"Désignation\", \"Reference\", \"Document\",\"Prix\",\"Taxes\",\"Actions\"],\r\n                //field: [\"Désignation\", \"Prix\",\"Prix\"],\r\n                field:\"\",\r\n                holdlist:[],\r\n                encompte:false,\r\n                codepays:'',\r\n                devise:'',\r\n                numeroclient:\"\"\r\n\r\n            };\r\n        },\r\n        beforeMount(){\r\n\r\n          this.codepays = this.$i18n.locale\r\n            this.devise = localStorage.getItem('devise')\r\n\r\n            console.log('codepayes',this.$store.state.authData.role)\r\n\r\n            if(this.$store.state.authData.role.indexOf('cg') !== -1){\r\n                this.$router.push({ name: 'allvisit_list', params: { id: '0' }})\r\n                return;\r\n            }\r\n            if(this.$store.state.authData.role.indexOf('controleur') !== -1){\r\n                this.$router.push({name: 'visit_start'})\r\n                return;\r\n            }\r\n\r\n        },\r\n        filters:{\r\n            momentes: function (date) {\r\n                return moment(date).format('yyyy-MM-dd HH:mm');\r\n            },\r\n\r\n            currencys:function (value,codepays,devise) {\r\n\r\n                return new Intl.NumberFormat(codepays, { style: 'currency', currency: devise }).format(value);\r\n            },\r\n            currencysout:function (value,codepays,devise) {\r\n                console.log('intl',value)\r\n                var intl =  new Intl.NumberFormat(codepays, { style: 'currency', currency: devise }).format(value);\r\n                console.log('intl',intl)\r\n                return intl.replace(devise,'')\r\n            }\r\n\r\n        },\r\n        components:{salesreceipt, AutoComplete,Catproductes,bilan,reference},\r\n        computed: {\r\n\r\n            ...mapGetters([\"getStatusHold\",\"getProducts\",\"getCustomers\",\"getCustomer\",\"getStatus\",\"getCatProducts\",\"GetBox\",\"GETBILAN\",\"GetEncaissements\",\"getObjetHold\",\r\n                \"getHoldList\",\"getSelectHold\",\"GetProductsHold\",\"MoveProductsHold\",\"GetBoxOpen\",\"GetCaisseOpen\",\"GetCHECKSESSION\",\"GetRemoveAllProducts\"]),\r\n\r\n        },\r\n\r\n        methods: {\r\n            ...mapActions([\"FetchCatProducts\",\"FetchSalesProducts\",\"registerCustom\",\"FetchProducts\",\r\n                \"FetchSellers\",\"FetchContacts\",\"FetchCustomers\",\"inAccounts\"\r\n                ,\"inBoxs\",\"addhold\",\"closebox\",\"openboxs\",\"removehold\",\"checksessione\",\"holdliste\",\"SelectHolds\",\"getProductsHold\",\"addProductsHold\",\"removeProductsHold\",\"removeAllProductsHold\"]),\r\n\r\n            contactsupdate(){\r\n                this.$store.state.categorieproducts.contactsId = 0\r\n            },\r\n            clientsupdate(){\r\n                this.$store.state.categorieproducts.clientsId = 0\r\n            },\r\n\r\n            resetWindows: function (){\r\n                this.$refs.childAuto.resetWindow();\r\n                this.$refs.childAutos.resetWindow();\r\n                this.form.Reference = \" \"\r\n            },\r\n\r\n            savechange(data){\r\n\r\n                console.log('savechange',data);\r\n                \r\n                switch(data.msg){\r\n\r\n                    case 'clients':\r\n                        this.numeroclient = data.item.telephone\r\n                        this.$store.state.categorieproducts.nomclient = data.item.nom + \" \" +data.item.prenom\r\n                        this.$store.state.categorieproducts.clientsId = data.item.clientId\r\n\r\n                        break;\r\n\r\n                    case 'contacts':\r\n\r\n                        this.numerocontacts = data.item.telephone\r\n                        this.$store.state.categorieproducts.nomcontacts = data.item.nom + \" \" +data.item.prenom\r\n                        this.$store.state.categorieproducts.contactsId = data.item.contactId\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconsole.log('state',this.$store.state.categorieproducts.contactsId)\r\n\r\n                        break;\r\n                    case 'reference':\r\n\r\n                        break;\r\n\r\n                }\r\n\r\n\r\n            },\r\n            setreference(value){\r\n                console.log('form','form')\r\n                this.form.Reference=value\r\n\r\n            },\r\n            openmodalbox(){\r\n                this.$bvModal.show('confirmopenAccount')\r\n            },\r\n            closemodalbox(){\r\n                this.$bvModal.show('confirmcloseAccount')\r\n            },\r\n            setoverlay(value){\r\n                if(!this.forcard){\r\n                    this.forcard = value\r\n                }\r\n\r\n            },\r\n            setlistpr(value){\r\n\r\n                this.forcard = false\r\n                if(this.search) {\r\n                    this.show_refer = !this.show_refer\r\n                }\r\n                if(value[0].produit!=null){\r\n                    this.products=value;\r\n                }\r\n                console.log('setlistpr',value[0].produit)\r\n            },\r\n            stringToBoolean: function(string){\r\n\r\n                if(string!=null){\r\n                    switch(string.trim()){\r\n                        case \"true\": case \"yes\": case \"1\": return true;\r\n                        case \"false\": case \"no\": case \"0\": case null: return false;\r\n                        default: return Boolean(string);\r\n                    }\r\n                }\r\n\r\n            },\r\n                print (){\r\n                // Pass the element id here\r\n                this.$htmlToPaper('printMe');\r\n            },\r\n            cancels (){\r\n                // Pass the element id here\r\n                this.box=false;\r\n                this.$bvModal.hide('tests')\r\n                console.log('cancels',this.box)\r\n            },\r\n            closecaisse(){\r\n\r\n                console.log('close')\r\n                this.removehold({number:this.selecthold.number,close:true})\r\n                //this.removeAllProductsHold({number:this.selecthold.number,sessionCaisseId:localStorage.getItem(\"sessioncaisse\")})\r\n\r\n            },\r\n            registerCustomer(variant = null) {\r\n\r\n                /* setTimeout(() => {\r\n\r\n                    this.$refs.registerPartners.registerp(true)\r\n                    console.log('hello',this.formattedreferenceValue)\r\n\r\n                },4000);*/\r\n\r\n                this.registerCustom(variant)\r\n                this.variant  = variant\r\n\r\n                console.log('relandes',variant)\r\n\r\n            },\r\n\r\n            //Aucun Produit Selectionne\r\n            inAccount() {\r\n\r\n                this.show=!this.show\r\n                this.$bvModal.hide('confirminAccount')\r\n\r\n                this.inAccounts(\r\n\r\n                    {\r\n                        produitVue:this.listproducts,\r\n                        montantTotal:this.invoice_total,\r\n                        montantHT:this.Montant_total,\r\n                        montantEncaisse:this.form.montant_encaisse,\r\n                        sessionCaisseId:localStorage.getItem(\"sessioncaisse\"),\r\n                        clientId:this.$store.state.clientsId,\r\n                        vendeurId:this.$store.state.vendeursId,\r\n                        contactId:this.$store.state.contactsId,\r\n                        type:0,\r\n                        lang: this.$i18n.locale\r\n                    }\r\n                )\r\n\r\n                //this.inAccounts()\r\n            },\r\n\r\n            launchBox(){\r\n\r\n          \r\n\t\t\t\tconsole.log('state',this.$store.state.categorieproducts.nomcontacts.length)\r\n\t\t\t\tconsole.log('state',this.$store.state.categorieproducts.nomcontacts)\r\n\t\t\t\tconsole.log('state',this.numerocontacts.length)\r\n\t\t\t\tconsole.log('state',this.numerocontacts)\r\n\r\n\t\t\t\t\r\n                //if(this.$store.state.categorieproducts.nomcontacts.length===0 || this.numerocontacts.length===0){\r\n                if(this.$store.state.categorieproducts.nomcontacts.length===0 || this.numerocontacts.length===0){\r\n                    this.makeToast(this.$t('select_contact'),'error')\r\n                    return ;\r\n                }\r\n\r\n                if(this.listproducts.length===0){\r\n                    this.makeToast(this.$t('no_product'),'error')\r\n                    return ;\r\n                }\r\n\r\n                if(this.form.montant_encaisse===0){\r\n                    this.makeToast(this.$t('which_amount'),'error')\r\n                    return ;\r\n                }\r\n                this.encompte = false\r\n\r\n                this.$bvModal.show('confirminBox')\r\n            },\r\n\r\n            launchAccount(){\r\n\t\t\t\r\n                if(this.$store.state.categorieproducts.contactsId===0){\r\n                    this.makeToast(this.$t('select_contact'),'error')\r\n                    this.$bvModal.hide('confirminAccount')\r\n                    return ;\r\n                }\r\n\r\n\r\n                if(this.listproducts.length === 0){\r\n                    this.makeToast(this.$t('no_product'),'error')\r\n                    this.$bvModal.hide('confirminAccount')\r\n                    return ;\r\n                }\r\n\r\n\r\n                if(this.form.montant_encaisse > 0){\r\n                    this.makeToast(this.$t('montant_encaisse_null'),'error')\r\n                    this.$bvModal.hide('confirminAccount')\r\n                    return ;\r\n                }\r\n\r\n\r\n                this.encompte = true\r\n                this.$bvModal.show('confirminAccount')\r\n\r\n            },\r\n\r\n            inBox() {\r\n\r\n                this.$bvModal.hide('confirminBox')\r\n                this.show=true\r\n\r\n                console.log('contactID',this.$store.state.categorieproducts.contactsId)\r\n\r\n                console.log('clientId',this.$store.state.categorieproducts.clientsId)\r\n\r\n\r\n                this.inBoxs(\r\n\r\n                    {\r\n                        produitVue:this.listproducts,\r\n                        montantTotal:this.invoice_total,\r\n                        montantHT:this.Montant_total,\r\n                        montantEncaisse:this.form.montant_encaisse,\r\n                        sessionCaisseId:localStorage.getItem(\"sessioncaisse\"),\r\n                        type:(this.listproducts[0].libelle==='dec')?2:1,\r\n                        clientId:this.$store.state.categorieproducts.clientsId,\r\n                        vendeurId:this.$store.state.categorieproducts.vendeursId,\r\n                        contactId:this.$store.state.categorieproducts.contactsId,\r\n                        contacclt:this.$store.state.categorieproducts.contacclt,\r\n                        lang: this.$i18n.locale,\r\n                        nomclient:this.$store.state.categorieproducts.nomclient,\r\n                        numeroclient:this.numeroclient,\r\n                        nomcontacts:this.$store.state.categorieproducts.nomcontacts,\r\n                        numerocontacts:this.numerocontacts,\r\n                        document:this.document\r\n                    }\r\n\r\n                )\r\n\r\n            },\r\n            closeBox(){\r\n\r\n                console.log('closebox')\r\n                //this.$bvModal.show('bilan')\\\r\n                this.closeb=false\r\n                this.closebox({\"ouvertureAmount\":this.ouvertureAmount})\r\n\r\n            },\r\n\r\n            openBox(){\r\n\r\n                //this.$bvModal.hide('confirmopenAccount')\r\n                // if(this.boxopen===\"false\"){\r\n                //     this.makeToast(\"Caisse Ouverte veuillez la fermer\",\"error\")\r\n                //     return;\r\n                // }\r\n                this.openb=false\r\n                this.openboxs({\"ouvertureAmount\":this.ouvertureAmount})\r\n\r\n            },\r\n\r\n            Addcat(product) {\r\n\r\n                console.log('product',product)\r\n\r\n                if((this.form.Reference)==''){\r\n                    this.makeToast(this.$t('ref_enter'),'error')\r\n                    return ;\r\n                }\r\n\r\n                if(product.produit.libelle=='dec' && this.listproducts.length!=0){\r\n\r\n\r\n                    this.makeToast(this.$t('product_waiting'),'error')\r\n\r\n\r\n                    /*if(this.listproducts.length!=0){\r\n                        this.listproducts = []\r\n                        this.removeAllProductsHold(product)\r\n                        console.log('valcatproduct',product.selecthold)\r\n\r\n                    }else{\r\n                        console.log('valcatproduct','vide')\r\n                    }*/\r\n\r\n\r\n                }\r\n                product.selecthold=this.selecthold\r\n                product.reference = this.form.Reference\r\n                this.forcard = true\r\n                this.addProductsHold(product)\r\n\r\n            },\r\n            /*searchreference(){\r\n\r\n                this.show_refer=!this.show_refer\r\n                this.search = true;\r\n                this.searchReference(this.form.Reference)\r\n            },*/\r\n            applyTax(prix,taxes){\r\n\r\n                taxes.forEach((value) => {\r\n\r\n                    if(!value.incluse){\r\n                        prix = prix + (prix*value.valeur)/100\r\n                    }\r\n                });\r\n                return prix\r\n            },\r\n            SelectHold(item){\r\n\r\n                console.log('hold',item.number)\r\n\r\n                this.SelectHolds(item)\r\n                //requete pour recuperer la liste des produits\r\n            },\r\n            checkIdHold(obj, id) {\r\n\r\n                return obj.map(function(item) { return item.holdId; }).indexOf(id);\r\n\r\n            },\r\n            invoiceTotal() {\r\n\r\n                var subtotal,total;\r\n                subtotal = this.listproducts.reduce(function(sum, item) {\r\n                    var cost = parseFloat(item.prix);\r\n                    if (!isNaN(cost)) {\r\n                        return sum + cost;\r\n                    }\r\n                }, 0);\r\n\r\n                this.Montant_total = subtotal.toFixed(2);\r\n                // tax\r\n                //total = subtotal * (this.invoice_tax / 100) + subtotal;\r\n                total = this.invoice_tax + subtotal;\r\n\r\n                /*switch (operande) {\r\n\r\n                    case \"+\":\r\n                        total = this.invoice_tax + subtotal;\r\n                        break;\r\n\r\n                    case \"-\":\r\n                        total = Math.abs(subtotal - this.invoice_tax) ;\r\n                        break;\r\n                }*/\r\n\r\n                total = parseFloat(total);\r\n                if (!isNaN(total)) {\r\n                    this.invoice_total = total.toFixed(2);\r\n                    this.form.montant_encaisse = this.invoice_total\r\n                } else {\r\n                    this.invoice_total = \"0.00\";\r\n                }\r\n\r\n            },\r\n            taxTotal(prix,operande){\r\n\r\n                var subtotaltax ,ageTotal;\r\n\r\n                //list of taxes of thisproduct\r\n                subtotaltax =  this.listtax.reduce((data, user) => {\r\n                    ageTotal = (ageTotal || 0) + user.valeur\r\n                    return ageTotal;\r\n                }, {});\r\n\r\n\r\n                //calculate amount and add it in total amout tax\r\n                if (!isNaN(subtotaltax)) {\r\n                    switch (operande) {\r\n                        case \"+\":\r\n                            console.log('subtotal',subtotaltax)\r\n                            this.invoice_tax = this.invoice_tax + ((subtotaltax * prix)/100)\r\n                            break;\r\n                        case \"-\":\r\n\r\n                            this.invoice_tax = Math.abs(this.invoice_tax - ((subtotaltax * prix)/100))\r\n                            break;\r\n                    }\r\n                    this.invoice_taxs = this.invoice_tax;\r\n\r\n                }\r\n\r\n                /*  subtotal = this.listtax.reduce(function(sum, item) {\r\n                      var cost = parseFloat(item.valeur);\r\n                      if (!isNaN(cost)) {\r\n\r\n                          console.log('subtotal',cost)\r\n                          return sum + cost;\r\n\r\n                      }\r\n                  }, 0);*/\r\n\r\n            },\r\n\r\n            checkId(obj, id) {\r\n\r\n                return obj.map(function(item) { return item.reference; }).indexOf(id);\r\n\r\n            },\r\n            removeCatProducts(product) {\r\n\r\n                console.log('index',product)\r\n                this.removeProductsHold(product)\r\n\r\n            },\r\n            SeeTaxProduct(product) {\r\n\r\n                this.taxes = product.taxes\r\n                this.$bvModal.show('test')\r\n\r\n\r\n            },\r\n            FetchProduct(catproduct){\r\n                console.log('oproduct')\r\n\r\n                this.FetchProducts(catproduct)\r\n            },\r\n\r\n            /* makeToast(variant = null, msg) {\r\n                 this.$bvToast.toast(msg, {\r\n                     title: ` ${variant || \"default\"}`,\r\n                     variant: variant,\r\n                     solid: true\r\n                 });\r\n             },*/\r\n\r\n            makeToast(variant = null,type) {\r\n                console.log('Please fill the form correctly',variant)\r\n                this.$toasted.show(variant,{type:type})\r\n            },\r\n\r\n            AddHold(){\r\n\r\n                this.addhold()\r\n                console.log('bilan', this.$store.state.categorieproducts.contactsId)\r\n            },\r\n\r\n            RemoveHold(){\r\n\r\n                this.$store.state.caisses.statusrequete = false\r\n                //console.log('hello',this.selecthold.number)\r\n\r\n                this.removehold({number:this.selecthold.number,\r\n                    close:true})\r\n            },\r\n\r\n        },\r\n\r\n        mounted() {\r\n\r\n            if(this.$store.state.authData.role.indexOf('controleur') !== -1){\r\n                return;\r\n            }\r\n            if(this.$store.state.authData.role.indexOf('cg') !== -1){\r\n                return;\r\n            }\r\n\r\n            this.boxopen = this.stringToBoolean((localStorage.getItem('boxopen')));\r\n            this.show = (localStorage.getItem('boxshow')!=null)?(this.stringToBoolean((localStorage.getItem('boxshow')))):\"\" ;\r\n\r\n\r\n            this.checksessione()\r\n            this.holdliste()\r\n\r\n\r\n            console.log(moment().format(\"yyyy-MM-DD\"))\r\n            console.log('boxopen',this.boxopen)\r\n            console.log('codepays',this.codepays)\r\n\r\n            this.FetchCatProducts()\r\n            this.FetchSalesProducts({number:localStorage.getItem(\"selecthold\")})\r\n\r\n            //this.closeBox()\r\n            //this.searchPartners({val:'t',type:'clients'})\r\n            //this.FetchContacts()\r\n            //this.FetchSellers()\r\n            //this.FetchCustomers()\r\n\r\n        },\r\n\r\n        watch: {\r\n\r\n\r\n            GetCHECKSESSION:function(value){\r\n\r\n                console.log('checksession',value)\r\n\r\n                this.boxopen = this.stringToBoolean((localStorage.getItem('boxopen')))\r\n                this.show = this.stringToBoolean((localStorage.getItem('boxshow')))\r\n\r\n                console.log('show',this.boxopen)\r\n\r\n               // this.show = (localStorage.getItem(\"boxshow\"))=='true'\r\n                console.log('show',(this.show))\r\n\r\n            },\r\n\r\n\r\n            GetRemoveAllProducts:function(value){\r\n\r\n\r\n                console.log('remov',value)\r\n                this.show=false\r\n                if(value===0){\r\n                \r\n                   // this.invoice_taxs=this.invoice_tax\r\n                    console.log('remov',this.invoice_taxs)\r\n                    this.$bvModal.show('tests')\r\n\r\n                    this.listproducts=[]\r\n                    this.listtax=[]\r\n                    this.invoice_tax = 0\r\n                    this.invoiceTotal()\r\n\r\n                    /*this.$store.state.categorieproducts.contactsId=0\r\n                    this.$store.state.categorieproducts.vendeursId=0\r\n                    this.$store.state.categorieproducts.clientsId=0*/\r\n                    this.form.Reference=\"\"\r\n                }else if(value===1){\r\n                    this.makeToast(this.$t('error'),0)\r\n                }\r\n                this.$store.state.caisses.removeallproducts=2;\r\n\r\n            },\r\n\r\n            GetCaisseOpen:function(value){\r\n\r\n                if(!value) {\r\n\r\n                    this.show = false\r\n                    this.$bvModal.hide('confirmopenAccount')\r\n                    this.openb=true\r\n                    this.boxopen = false\r\n                    localStorage.setItem(\"boxopen\",false)\r\n                    localStorage.setItem(\"boxshow\",false)\r\n                }\r\n                this.$store.state.caisses.caisseopen=true;\r\n\r\n                /*else{\r\n                    console.log('stdatus',value)\r\n\r\n                    this.$bvModal.hide('confirmcloseAccount')\r\n                    console.log('stdatus',value)\r\n                    localStorage.setItem(\"boxopen\",value)\r\n\r\n                }\r\n                */\r\n\r\n\r\n            },\r\n\r\n            getCatProducts: function(value){\r\n\r\n                this.cat=[]\r\n                this.cat = value\r\n                console.log('registerp',value)\r\n            },\r\n            /*getProducts(val){\r\n                if(this.search) {\r\n                    this.show_refer = !this.show_refer\r\n                }\r\n                console.log('resultl',val)\r\n                //this.makeToast('sucess','success')\r\n                this.products=val;\r\n            },*/\r\n            getStatus(value){\r\n\r\n                this.$refs.registerPartners.registerp(value)\r\n                if(value){\r\n                    this.statute=false\r\n                }else{\r\n                    console.log('registerp',value)\r\n                }\r\n\r\n            },\r\n            getb(){\r\n                return this.boxopen\r\n            },\r\n\r\n            getCustomer(val){\r\n\r\n                this.statute=false\r\n                console.log('statute',this.variant)\r\n\r\n                //useAutocomplete().state.userInput=\"hello\"\r\n\r\n                console.log('statute',val)\r\n                if(Object.keys(val).length !== 0) {\r\n\r\n\r\n                    if(this.variant.variant === \"caisse/clients\"){\r\n                        this.$bvModal.hide('registercustomer')\r\n                        this.clients.push(val)\r\n                        this.makeToast(this.$t('customer_add'),'success')\r\n                    }\r\n\r\n                    if(this.variant.variant === \"caisse/contacts\"){\r\n\r\n                        this.$bvModal.hide('registercontact')\r\n\r\n\r\n                        // this.contacts.push(val)\r\n                        this.makeToast(this.$t('contact_add'),'success')\r\n                    }\r\n\r\n                    if(this.variant.variant === \"caisse/vendeurs\"){\r\n                        this.$bvModal.hide('registerseller')\r\n                       // this.clients.push(val)\r\n                        this.makeToast(this.$t('sellers_add'),'success')\r\n                    }\r\n\r\n                    this.$bvModal.msgBoxOk('',)\r\n\r\n\r\n                }else{\r\n\r\n                    //this.show=false\r\n                    this.makeToast(this.$t('customer_denied'), \"error\")\r\n                }\r\n            },\r\n            GetBox(val){\r\n                this.box=val;\r\n\r\n                if(val){\r\n\r\n                    console.log('encaiss',this.holdlist.length)\r\n\r\n                    if(this.holdlist.length>1){\r\n                        this.show=false\r\n                        this.closecaisse()\r\n                    }else{\r\n\r\n                        this.removeAllProductsHold({number:this.selecthold.number,\r\n                            sessionCaisseId:localStorage.getItem(\"sessioncaisse\")})\r\n                    }\r\n                    this.$store.state.categorieproducts.box = false\r\n\r\n                }else{\r\n                    this.show=false\r\n                }\r\n               // this.box=false;\r\n\r\n            },\r\n\r\n            GetEncaissements(val){\r\n\r\n                this.encaissements=val\r\n\r\n\t\t\t\tthis.numeroclient = \"\"\r\n\t\t\t\tthis.numerocontacts = \"\"\r\n\t\t\t\tthis.form.Reference = \"\"\r\n\r\n                this.$emit('setreference',\"\")\r\n\r\n                this.field = this.$store.state.categorieproducts.contacclt\r\n                this.$store.state.categorieproducts.contactsId=0\r\n                this.$store.state.categorieproducts.vendeursId=0\r\n                this.$store.state.categorieproducts.clientsId=0\r\n\r\n                this.$emit('erase',{val:'contacts'})\r\n\r\n                console.log('enc5',val)\r\n                this.resetWindows()\r\n                //useAutocomplete().state.userInput=\"\"\r\n\r\n            },\r\n\r\n\r\n            GETBILAN(val){\r\n\r\n                this.bilan=val\r\n                console.log('bilan',val)\r\n\r\n            },\r\n            getObjetHold(val){\r\n\r\n                //this.selecthold = val\r\n                this.holdlist.push(val);\r\n\r\n            },\r\n            getStatusHold(val){\r\n\r\n                if(val===200){\r\n                    let indexIds = this.checkIdHold(this.holdlist,this.selecthold.holdId)\r\n                    console.log('objetshold',indexIds)\r\n\r\n                    this.holdlist.splice(indexIds, 1);\r\n                    this.holdlist.sort();\r\n\r\n                }\r\n\r\n            },\r\n\r\n            getHoldList(val){\r\n                this.holdlist=[]\r\n                this.holdlist=val;\r\n\r\n                console.log('holdlistes',this.holdlist)\r\n\r\n                console.log('holdtes',localStorage.getItem(\"selecthold\"))\r\n                this.selecthold = this.holdlist[0]\r\n\r\n                /*if(localStorage.getItem(\"selecthold\") === 'null' || localStorage.getItem(\"selecthold\") === null ){\r\n\r\n                    this.selecthold = this.holdlist[0]\r\n                    console.log('holdlist',this.holdlist[0])\r\n                }\r\n\r\n                if(Object.keys(localStorage.getItem(\"selecthold\")).length !== 0){\r\n\r\n                    this.selecthold = localStorage.getItem(\"selecthold\")\r\n                    console.log('holdlis',this.selecthold)\r\n\r\n                }\r\n\r\n                console.log('hhhh',this.selecthold)*/\r\n                this.SelectHolds(this.selecthold)\r\n\r\n            },\r\n            getSelectHold(val){\r\n\r\n                this.selecthold = val\r\n\r\n                localStorage.setItem(\"selecthold\",val)\r\n\r\n                //this.$store.state.categorieproducts.contactsId=0\r\n                // this.$store.state.categorieproducts.vendeursId=0\r\n                //this.$store.state.categorieproducts.clientsId=0\r\n                useAutocomplete().state.userInput=\"\"\r\n\r\n                console.log('soooobjethold',val)\r\n                this.getProductsHold(this.selecthold)\r\n\r\n            },\r\n            GetProductsHold(val){\r\n\r\n                console.log('getp',val)\r\n\r\n                //this.listproducts = val\r\n                this.listproducts=[]\r\n                this.listtax=[]\r\n\r\n                if(val.length!=0) {\r\n                    val.forEach((value) => {\r\n\r\n                        this.listproducts.push({\r\n                            produitId: value.produit.produitId,\r\n                            libelle: value.produit.libelle,\r\n                            reference: value.reference,\r\n                            holdId: this.selecthold.holdId,\r\n                            prix: value.produit.prix,//this.applyTax(value.produit.prix,value.taxe),\r\n                            categorie: value.produit.categorieProduit.libelle,\r\n                            descriptionCat: value.produit.categorieProduit.description,\r\n                            taxes: value.taxes\r\n                        });\r\n\r\n                        this.listtax  = value.taxes\r\n                        this.taxTotal(value.produit.prix,\"+\")\r\n\r\n                    });\r\n\r\n                }else{\r\n                    this.invoice_tax  = 0\r\n                }\r\n                this.invoiceTotal()\r\n\r\n            },\r\n\r\n            MoveProductsHold(value){\r\n\r\n                console.log('movef',value)\r\n                this.forcard = false\r\n\r\n                var operande =\"\"\r\n                if(value.statut===0) {\r\n\r\n                    if(value.success){\r\n\r\n                        this.listproducts.reference = this.form.Reference\r\n                        operande = \"+\"\r\n                        this.listproducts.push({\r\n\r\n                            produitId: value.produit.produitId,\r\n                            libelle: value.produit.libelle,\r\n                            reference: this.listproducts.reference,\r\n                            holdId: this.selecthold.holdId,\r\n                            prix: value.produit.prix,//this.applyTax(value.produit.prix,value.taxe),\r\n                            categorie: value.produit.categorieProduit.libelle,\r\n                            descriptionCat: value.produit.categorieProduit.description,\r\n                            taxes: value.taxe\r\n\r\n                        });\r\n\r\n                        //this.form.Reference = ''\r\n                        this.$refs.matricule.resetfield()\r\n                        console.log(new Intl.NumberFormat('CM', { style: 'currency', currency: 'XAF' }).format(value.produit.prix));\r\n\r\n                        if(!value.taxe.incluse){\r\n\r\n                            this.listtax = value.taxe\r\n                            console.log('movee', this.listtax)\r\n\r\n                        }\r\n                        operande=\"+\";\r\n                        this.taxTotal(value.produit.prix,operande)\r\n\r\n                    }else{\r\n                        console.log('prxxxoducts',value.message.code)\r\n                        makeToast(this.$t(value.message.code),this.$t(value.message.level))\r\n                        //this.makeToast(this.$t(value.message.code),'error')\r\n\r\n\r\n                        //obtenir object par son id\r\n                    }\r\n\r\n                }else{\r\n\r\n                    operande=\"-\";\r\n\r\n                    //console.log('checkid',this.checkId(this.listproducts,value.reference))\r\n                    let indexId = this.checkId(this.listproducts,value.reference)\r\n                    this.listtax = (this.listproducts[indexId]).taxes\r\n\r\n\r\n                    this.taxTotal(this.listproducts[indexId].prix,operande)\r\n                    this.listproducts.splice(indexId, 1);\r\n\r\n\r\n\r\n                }\r\n\r\n\r\n                this.invoiceTotal()\r\n\r\n            },\r\n\r\n            GetBoxOpen(value){\r\n\r\n\r\n                if(!value) {\r\n\r\n                    this.show = false\r\n                    this.closeb=true\r\n                    this.$bvModal.hide('confirmopenAccount')\r\n\r\n                }else{\r\n                    this.closeb=true\r\n                    this.$bvModal.hide('confirmcloseAccount')\r\n\r\n                    this.show = true\r\n                    this.boxopen= false\r\n                    this.boxopen= true\r\n                    console.log('stdatus',value)\r\n\r\n                    this.selecthold={}\r\n                    this.listproducts=[]\r\n                    this.listtax=[]\r\n                    this.invoiceTotal()\r\n                    this.invoice_tax = 0\r\n                    this.holdlist=[]\r\n\r\n\r\n                    localStorage.setItem(\"boxopen\",true)\r\n                    localStorage.setItem(\"boxshow\",true)\r\n\r\n\r\n                    this.$store.state.caisses.boxopens=false\r\n                    // this.$bvModal.show('bilan')\r\n\r\n                }\r\n\r\n\r\n            },\r\n        }\r\n    };\r\n</script>\r\n\r\n<style scoped>\r\n    .Hold {\r\n        cursor: pointer;\r\n        text-align:center;\r\n        margin:5px 1px;\r\n        padding: 2px 10px;\r\n        background-color:#4C5261;\r\n        border-radius:3px;\r\n        color:#E4E6E7;\r\n        text-transform:uppercase;\r\n        font-size: 20px;\r\n        display:inline-block;\r\n        font-weight:600;\r\n        padding-bottom: 7px;\r\n        border-bottom: 3px solid #212C32;\r\n    }\r\n    .Hold span {\r\n        font-size: 12px;\r\n        color:#b9b2b2;\r\n        margin-left: 8px;\r\n    }\r\n    .selectedHold{\r\n        /*background-color:#35B8E0;*/\r\n        color:#E2E2E2;\r\n        border-bottom: 3px solid #f65e48;\r\n    }\r\n    .pl {\r\n        background-color:#253138;\r\n        color:#fff;\r\n        border-bottom: 3px solid #101417;\r\n    }\r\n    .taille{\r\n        width:120px;\r\n        height: 120px;\r\n        margin:10px;\r\n        background: #ffffff9e;\r\n    }\r\n    .rights{\r\n        position: relative;right: 0;margin-right: 10px;\r\n    }\r\n\r\n    img {\r\n        height:100vh;\r\n    }\r\n    .overlay-box{\r\n        background: #eee;\r\n    }\r\n    .scroll-card{\r\n        height: 250px;\r\n        display: flex !important;\r\n        flex-direction: row;\r\n        flex-grow: 1;\r\n        overflow: auto;\r\n    }\r\n</style>\r\n"]}]}
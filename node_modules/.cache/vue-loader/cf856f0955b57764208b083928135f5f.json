{"remainingRequest":"/Users/macbookpro/IdeaProjects/collectedonnee/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/macbookpro/IdeaProjects/collectedonnee/src/views/app/components/CanvasDraw.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/macbookpro/IdeaProjects/collectedonnee/src/views/app/components/CanvasDraw.vue","mtime":1661425840146},{"path":"/Users/macbookpro/IdeaProjects/collectedonnee/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macbookpro/IdeaProjects/collectedonnee/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/macbookpro/IdeaProjects/collectedonnee/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/macbookpro/IdeaProjects/collectedonnee/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0NhbnZhc0RyYXcnLAogIHByb3BzOiB7CiAgICBicnVzaFNpemU6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAzLAogICAgfSwKICAgIHdpZHRoOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogNjQwLAogICAgfSwKICAgIGhlaWdodDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDQ4MCwKICAgIH0sCiAgICBvdXRwdXROYW1lOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ2NhbnZhcycsCiAgICB9LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNhbnZhc0NvbnRleHQ6IG51bGwsCiAgICAgIGN1cnNvckNvbnRleHQ6IG51bGwsCiAgICAgIGlzRHJhd2luZzogZmFsc2UsCiAgICAgIGxhc3RYOiAwLAogICAgICBsYXN0WTogMCwKICAgICAgdG9vbHM6IFsKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAnUGVuY2lsJywKICAgICAgICAgIGNvbG9yOiAnIzAwMDAwMCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAnRXJhc2VyJywKICAgICAgICB9LAogICAgICBdLAogICAgICBzZWxlY3RlZFRvb2xJZHg6IDAsCiAgICB9OwogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuc2V0Q2FudmFzKCk7CiAgICB0aGlzLmJpbmRFdmVudHMoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHNldENhbnZhcygpIHsKICAgICAgdGhpcy4kcmVmcy5jYW52YXNXcmFwcGVyLnN0eWxlLmdyaWRUZW1wbGF0ZUNvbHVtbnMgPSBgJHt0aGlzLndpZHRofXB4IDMwcHhgOwogICAgICB0aGlzLiRyZWZzLmNhbnZhc1dyYXBwZXIuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRoICsgMzB9cHhgOwogICAgICB0aGlzLiRyZWZzLmNhbnZhc1dyYXBwZXIuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5oZWlnaHR9cHhgOwogICAgICB0aGlzLmNhbnZhc0NvbnRleHQgPSB0aGlzLiRyZWZzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICB0aGlzLmNhbnZhc0NvbnRleHQubGluZUpvaW4gPSAncm91bmQnOwogICAgICB0aGlzLmNhbnZhc0NvbnRleHQubGluZUNhcCA9ICdyb3VuZCc7CiAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5saW5lV2lkdGggPSB0aGlzLmJydXNoU2l6ZTsKICAgICAgdGhpcy5jYW52YXNDb250ZXh0LnN0cm9rZVN0eWxlID0gdGhpcy50b29sc1t0aGlzLnNlbGVjdGVkVG9vbElkeF0uY29sb3I7CiAgICAgIHRoaXMuY3Vyc29yQ29udGV4dCA9IHRoaXMuJHJlZnMuY3Vyc29yLmdldENvbnRleHQoJzJkJyk7CiAgICB9LAogICAgYmluZEV2ZW50cygpIHsKICAgICAgdGhpcy4kcmVmcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGV2ZW50KSA9PiB7CiAgICAgICAgdGhpcy5pc0RyYXdpbmcgPSB0cnVlOwogICAgICAgIFt0aGlzLmxhc3RYLCB0aGlzLmxhc3RZXSA9IFtldmVudC5vZmZzZXRYLCBldmVudC5vZmZzZXRZXTsKICAgICAgfSk7CiAgICAgIHRoaXMuJHJlZnMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuZHJhdyk7CiAgICAgIHRoaXMuJHJlZnMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoKSA9PiB0aGlzLmlzRHJhd2luZyA9IGZhbHNlKTsKICAgICAgdGhpcy4kcmVmcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCAoKSA9PiB0aGlzLmlzRHJhd2luZyA9IGZhbHNlKTsKICAgIH0sCiAgICBjaGFuZ2VUb29sKHRvb2wpIHsKICAgICAgdGhpcy5zZWxlY3RlZFRvb2xJZHggPSB0b29sOwoKICAgICAgaWYodG9vbD09MCl7CiAgICAgICAgdGhpcy5icnVzaFNpemU9MwogICAgICAgIHRoaXMuY2FudmFzQ29udGV4dC5saW5lV2lkdGggPSB0aGlzLmJydXNoU2l6ZTsKICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5icnVzaFNpemU9MTIKICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQubGluZVdpZHRoID0gdGhpcy5icnVzaFNpemU7CiAgICAgIH0KICAgICAgdGhpcy5zZXRDYW52YXMoKQogICAgfSwKICAgIGRyYXcoZXZlbnQpIHsKICAgICAgdGhpcy5kcmF3Q3Vyc29yKGV2ZW50KTsKICAgICAgaWYgKCF0aGlzLmlzRHJhd2luZykgcmV0dXJuOwogICAgICBpZiAodGhpcy50b29sc1t0aGlzLnNlbGVjdGVkVG9vbElkeF0ubmFtZSA9PT0gJ0VyYXNlcicpIHsKICAgICAgICB0aGlzLmNhbnZhc0NvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2Rlc3RpbmF0aW9uLW91dCc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3Zlcic7CiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0LnN0cm9rZVN0eWxlID0gdGhpcy50b29sc1t0aGlzLnNlbGVjdGVkVG9vbElkeF0uY29sb3I7CiAgICAgIH0KICAgICAgdGhpcy5jYW52YXNDb250ZXh0LmJlZ2luUGF0aCgpOwogICAgICB0aGlzLmNhbnZhc0NvbnRleHQubW92ZVRvKHRoaXMubGFzdFgsIHRoaXMubGFzdFkpOwogICAgICB0aGlzLmNhbnZhc0NvbnRleHQubGluZVRvKGV2ZW50Lm9mZnNldFgsIGV2ZW50Lm9mZnNldFkpOwogICAgICB0aGlzLmNhbnZhc0NvbnRleHQuc3Ryb2tlKCk7CiAgICAgIFt0aGlzLmxhc3RYLCB0aGlzLmxhc3RZXSA9IFtldmVudC5vZmZzZXRYLCBldmVudC5vZmZzZXRZXTsKICAgIH0sCiAgICBkcmF3Q3Vyc29yKGV2ZW50KSB7CiAgICAgIHRoaXMuY3Vyc29yQ29udGV4dC5iZWdpblBhdGgoKTsKICAgICAgdGhpcy5jdXJzb3JDb250ZXh0LmVsbGlwc2UoCiAgICAgICAgICBldmVudC5vZmZzZXRYLCBldmVudC5vZmZzZXRZLAogICAgICAgICAgdGhpcy5icnVzaFNpemUsIHRoaXMuYnJ1c2hTaXplLAogICAgICAgICAgTWF0aC5QSSAvIDQsIDAsIDIgKiBNYXRoLlBJCiAgICAgICk7CiAgICAgIHRoaXMuY3Vyc29yQ29udGV4dC5zdHJva2UoKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5jdXJzb3JDb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7CiAgICAgIH0sIDEwMCk7CiAgICB9LAogICAgc2hvd0NvbG9yUGFsZXR0ZSgpIHsKICAgICAgY29uc3QgY29sb3JQYWxldHRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgY29sb3JQYWxldHRlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldmVudCkgPT4gewogICAgICAgIHRoaXMudG9vbHNbMF0uY29sb3IgPSBldmVudC50YXJnZXQudmFsdWU7CiAgICAgIH0pOwogICAgICBjb2xvclBhbGV0dGUudHlwZSA9ICdjb2xvcic7CiAgICAgIGNvbG9yUGFsZXR0ZS52YWx1ZSA9IHRoaXMudG9vbHNbMF0uY29sb3I7CiAgICAgIGNvbG9yUGFsZXR0ZS5jbGljaygpOwogICAgfSwKICAgIGRvd25sb2FkKCkgewogICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBsaW5rLmRvd25sb2FkID0gYCR7dGhpcy5vdXRwdXROYW1lfS5wbmdgOwogICAgICBsaW5rLmhyZWYgPSB0aGlzLiRyZWZzLmNhbnZhcy50b0RhdGFVUkwoKQoKICAgICAgY29uc29sZS5sb2coJ3RoaXMuJHJlZnMuY2FudmFzLnRvRGF0YVVSTCgpJyx0aGlzLiRyZWZzLmNhbnZhcy50b0RhdGFVUkwoKSkKICAgICAgLy9saW5rLmNsaWNrKCk7CgogICAgICAvLyBjb252ZXJ0IHRvIEJsb2IgKGFzeW5jKQogICAgICB0aGlzLiRyZWZzLmNhbnZhcy50b0Jsb2IoIChibG9iKSA9PiB7CiAgICAgICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKCBbIGJsb2IgXSwgIm15Y2FudmFzLnBuZyIgKTsKICAgICAgICBjb25zdCBkVCA9IG5ldyBEYXRhVHJhbnNmZXIoKTsKICAgICAgICBkVC5pdGVtcy5hZGQoIGZpbGUgKTsKCiAgICAgICAgbGV0IGZvcm1kYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgZm9ybWRhdGEuYXBwZW5kKCdpbWFnZScsZmlsZSkKCiAgICAgICAgdGhpcy4kZW1pdCgnc2VuZCcsZm9ybWRhdGEpCgogICAgICB9ICk7CiAgICB9LAogIH0KfQo="},{"version":3,"sources":["CanvasDraw.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA","file":"CanvasDraw.vue","sourceRoot":"src/views/app/components","sourcesContent":["<template>\n  <div class=\"canvas-wrapper\" ref=\"canvasWrapper\">\n    <div class=\"draw-area\">\n      <canvas id=\"canvas\" ref=\"canvas\" :width=\"width\" :height=\"height\"></canvas>\n      <canvas id=\"cursor\" ref=\"cursor\" :width=\"width\" :height=\"height\"></canvas>\n    </div>\n    <ul class=\"tools\">\n      <li id=\"tool-pencil\" :class=\"{ active: selectedToolIdx === 0 }\" @click=\"changeTool(0)\">\n        <img src=\"@/assets/edit.svg\"/>\n      </li>\n      <li id=\"tool-eraser\" :class=\"{ active: selectedToolIdx === 1 }\" @click=\"changeTool(1)\">\n        <img src=\"@/assets/eraser.svg\"/>\n      </li>\n      <li id=\"tool-color-palette\" @click=\"showColorPalette()\">\n        <img src=\"@/assets/color-palette.svg\"/>\n      </li>\n      <li id=\"tool-download\" @click=\"download()\">\n        <img src=\"@/assets/download.svg\"/>\n      </li>\n    </ul>\n  </div>\n</template>\n\n<script>\n\nexport default {\n  name: 'CanvasDraw',\n  props: {\n    brushSize: {\n      type: Number,\n      default: 3,\n    },\n    width: {\n      type: Number,\n      default: 640,\n    },\n    height: {\n      type: Number,\n      default: 480,\n    },\n    outputName: {\n      type: String,\n      default: 'canvas',\n    },\n  },\n  data() {\n    return {\n      canvasContext: null,\n      cursorContext: null,\n      isDrawing: false,\n      lastX: 0,\n      lastY: 0,\n      tools: [\n        {\n          name: 'Pencil',\n          color: '#000000',\n        },\n        {\n          name: 'Eraser',\n        },\n      ],\n      selectedToolIdx: 0,\n    };\n  },\n  mounted() {\n    this.setCanvas();\n    this.bindEvents();\n  },\n  methods: {\n    setCanvas() {\n      this.$refs.canvasWrapper.style.gridTemplateColumns = `${this.width}px 30px`;\n      this.$refs.canvasWrapper.style.width = `${this.width + 30}px`;\n      this.$refs.canvasWrapper.style.height = `${this.height}px`;\n      this.canvasContext = this.$refs.canvas.getContext('2d');\n      this.canvasContext.lineJoin = 'round';\n      this.canvasContext.lineCap = 'round';\n      this.canvasContext.lineWidth = this.brushSize;\n      this.canvasContext.strokeStyle = this.tools[this.selectedToolIdx].color;\n      this.cursorContext = this.$refs.cursor.getContext('2d');\n    },\n    bindEvents() {\n      this.$refs.canvas.addEventListener('mousedown', (event) => {\n        this.isDrawing = true;\n        [this.lastX, this.lastY] = [event.offsetX, event.offsetY];\n      });\n      this.$refs.canvas.addEventListener('mousemove', this.draw);\n      this.$refs.canvas.addEventListener('mouseup', () => this.isDrawing = false);\n      this.$refs.canvas.addEventListener('mouseout', () => this.isDrawing = false);\n    },\n    changeTool(tool) {\n      this.selectedToolIdx = tool;\n\n      if(tool==0){\n        this.brushSize=3\n        this.canvasContext.lineWidth = this.brushSize;\n      }else{\n        this.brushSize=12\n        this.canvasContext.lineWidth = this.brushSize;\n      }\n      this.setCanvas()\n    },\n    draw(event) {\n      this.drawCursor(event);\n      if (!this.isDrawing) return;\n      if (this.tools[this.selectedToolIdx].name === 'Eraser') {\n        this.canvasContext.globalCompositeOperation = 'destination-out';\n      } else {\n        this.canvasContext.globalCompositeOperation = 'source-over';\n        this.canvasContext.strokeStyle = this.tools[this.selectedToolIdx].color;\n      }\n      this.canvasContext.beginPath();\n      this.canvasContext.moveTo(this.lastX, this.lastY);\n      this.canvasContext.lineTo(event.offsetX, event.offsetY);\n      this.canvasContext.stroke();\n      [this.lastX, this.lastY] = [event.offsetX, event.offsetY];\n    },\n    drawCursor(event) {\n      this.cursorContext.beginPath();\n      this.cursorContext.ellipse(\n          event.offsetX, event.offsetY,\n          this.brushSize, this.brushSize,\n          Math.PI / 4, 0, 2 * Math.PI\n      );\n      this.cursorContext.stroke();\n      setTimeout(() => {\n        this.cursorContext.clearRect(0, 0, this.width, this.height);\n      }, 100);\n    },\n    showColorPalette() {\n      const colorPalette = document.createElement('input');\n      colorPalette.addEventListener('change', (event) => {\n        this.tools[0].color = event.target.value;\n      });\n      colorPalette.type = 'color';\n      colorPalette.value = this.tools[0].color;\n      colorPalette.click();\n    },\n    download() {\n      const link = document.createElement('a');\n      link.download = `${this.outputName}.png`;\n      link.href = this.$refs.canvas.toDataURL()\n\n      console.log('this.$refs.canvas.toDataURL()',this.$refs.canvas.toDataURL())\n      //link.click();\n\n      // convert to Blob (async)\n      this.$refs.canvas.toBlob( (blob) => {\n        const file = new File( [ blob ], \"mycanvas.png\" );\n        const dT = new DataTransfer();\n        dT.items.add( file );\n\n        let formdata = new FormData();\n        formdata.append('image',file)\n\n        this.$emit('send',formdata)\n\n      } );\n    },\n  }\n}\n</script>\n<style scoped>\n.canvas-wrapper {\n  display: grid;\n  position: relative;\n}\n#canvas {\n  background-color: #f9f9f9;\n  z-index: 0;\n}\n#cursor {\n  z-index: 1;\n  pointer-events: none;\n}\n.active {\n  background-color: #dea878 !important;\n}\n.tools {\n  margin: 0;\n  padding: 0;\n}\n.tools li{\n  padding: 4px;\n  background-color: #c8c8c8;\n  border-left: 1px solid #abaaaa;\n}\n.tools li:not(:last-child) {\n  border-bottom: 1px solid #abaaaa;\n}\n.draw-area canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n  border: 2px solid #c8c8c8;\n  border-radius: 10px 0 10px 10px;\n}\n</style>"]}]}